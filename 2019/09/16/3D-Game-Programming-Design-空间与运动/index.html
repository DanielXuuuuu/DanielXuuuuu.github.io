<!DOCTYPE html>





<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.3.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.3.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.3.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.3.0">

<link rel="stylesheet" href="https://fonts.loli.net/css?family=Noto Serif SC:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '7.3.0',
    exturl: false,
    sidebar: {"position":"left","width":280,"display":"post","offset":12,"onmobile":false},
    copycode: {"enable":true,"show_result":true,"style":"mac"},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="3D游戏编程的第三次作业：  使用Unity模拟出了太阳系中的行星运动 采用MVC设计模式编写了一个小游戏：牧师与恶魔  课程主页">
<meta name="keywords" content="课程作业,Unity">
<meta property="og:type" content="article">
<meta property="og:title" content="3D Game Programming &amp; Design - 空间与运动">
<meta property="og:url" content="http://yoursite.com/2019/09/16/3D-Game-Programming-Design-空间与运动/index.html">
<meta property="og:site_name" content="Daniel&#39;s Blog">
<meta property="og:description" content="3D游戏编程的第三次作业：  使用Unity模拟出了太阳系中的行星运动 采用MVC设计模式编写了一个小游戏：牧师与恶魔  课程主页">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/2019/09/16/3D-Game-Programming-Design-空间与运动/cenci.png">
<meta property="og:image" content="http://yoursite.com/2019/09/16/3D-Game-Programming-Design-空间与运动/init.png">
<meta property="og:image" content="http://yoursite.com/2019/09/16/3D-Game-Programming-Design-空间与运动/sun.png">
<meta property="og:image" content="http://yoursite.com/2019/09/16/3D-Game-Programming-Design-空间与运动/MVC.png">
<meta property="og:image" content="http://yoursite.com/2019/09/16/3D-Game-Programming-Design-空间与运动/p&d.png">
<meta property="og:updated_time" content="2019-09-21T11:08:50.832Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="3D Game Programming &amp; Design - 空间与运动">
<meta name="twitter:description" content="3D游戏编程的第三次作业：  使用Unity模拟出了太阳系中的行星运动 采用MVC设计模式编写了一个小游戏：牧师与恶魔  课程主页">
<meta name="twitter:image" content="http://yoursite.com/2019/09/16/3D-Game-Programming-Design-空间与运动/cenci.png">
  <link rel="canonical" href="http://yoursite.com/2019/09/16/3D-Game-Programming-Design-空间与运动/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>3D Game Programming & Design - 空间与运动 | Daniel's Blog</title>
  <meta name="generator" content="Hexo 3.9.0">
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Daniel's Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <p class="site-subtitle">A student of Software Engineering from Sun Yat-sen University</p>
      
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-about">
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-user"></i> <br>关于</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-tags">
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-categories">
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a href="javascript:;" class="popup-trigger">
        
          <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
      </li>
    
  </ul>

    

</nav>
  <div class="site-search">
    <div class="popup search-popup">
    <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocorrect="off" autocapitalize="none"
           placeholder="搜索..." spellcheck="false"
           type="text" id="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result"></div>

</div>
<div class="search-pop-overlay"></div>

  </div>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/DanielXuuuuu" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
      <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block post">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/09/16/3D-Game-Programming-Design-空间与运动/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Daniel Xu">
      <meta itemprop="description" content="Think twice, code once.">
      <meta itemprop="image" content="/images/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daniel's Blog">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">3D Game Programming & Design - 空间与运动

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-09-16 16:48:24" itemprop="dateCreated datePublished" datetime="2019-09-16T16:48:24+08:00">2019-09-16</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-09-21 19:08:50" itemprop="dateModified" datetime="2019-09-21T19:08:50+08:00">2019-09-21</time>
              </span>
            
          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/3D游戏编程/" itemprop="url" rel="index"><span itemprop="name">3D游戏编程</span></a></span>

                
                
              
            </span>
          

          
            <span class="post-meta-item" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="busuanzi-value" id="busuanzi_value_page_pv"></span>
            </span>
          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>3D游戏编程的第三次作业：</p>
<ul>
<li>使用Unity模拟出了太阳系中的行星运动</li>
<li>采用MVC设计模式编写了一个小游戏：牧师与恶魔</li>
</ul>
<p><a href="https://pmlpml.github.io/unity3d-learning/03-space-and-motion" target="_blank" rel="noopener">课程主页</a></p>
</blockquote>
<a id="more"></a>

<h5 id="简答并用程序验证"><a href="#简答并用程序验证" class="headerlink" title="简答并用程序验证"></a>简答并用程序验证</h5><blockquote>
<p>游戏对象运动的本质是什么？</p>
</blockquote>
<p>游戏对象运动的本质就是使用矩阵变换（平移、旋转、缩放）改变游戏对象的空间属性。</p>
<blockquote>
<p>请用三种方法以上方法，实现物体的抛物线运动。</p>
</blockquote>
<ul>
<li><p>方法一：运动分解。将抛物线运动分解为横向和纵向的运动叠加，直接修改物体的位置</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">method1</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> speed = <span class="number">200F</span>;   <span class="comment">//初速度</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> angle = <span class="number">60</span>;    <span class="comment">//起始方向与地面夹角    </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> G = <span class="number">9.8F</span>;     <span class="comment">//重力加速度</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> xSpeed;       <span class="comment">//x方向速度分量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> ySpeed;       <span class="comment">//y方向速度分量</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        xSpeed = speed * Mathf.Cos(angle / <span class="number">180</span> * Mathf.PI);</span><br><span class="line">        ySpeed = speed * Mathf.Sin(angle / <span class="number">180</span> * Mathf.PI);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">this</span>.transform.position += Vector3.right * Time.deltaTime * xSpeed;</span><br><span class="line">        <span class="keyword">this</span>.transform.position += Vector3.up * Time.deltaTime * ySpeed;</span><br><span class="line">        ySpeed -= G * Time.deltaTime;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法二：使用<code>Transform</code> 的方法 <code>Translate</code></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">method2</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> speed = <span class="number">200F</span>;   <span class="comment">//初速度</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> angle = <span class="number">60</span>;    <span class="comment">//起始方向与地面夹角    </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> G = <span class="number">9.8F</span>;     <span class="comment">//重力加速度</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> xSpeed;       <span class="comment">//x方向速度分量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> ySpeed;       <span class="comment">//y方向速度分量</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        xSpeed = speed * Mathf.Cos(angle / <span class="number">180</span> * Mathf.PI);</span><br><span class="line">        ySpeed = speed * Mathf.Sin(angle / <span class="number">180</span> * Mathf.PI);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Vector3 direction = (Vector3.right * xSpeed + Vector3.up * ySpeed) * Time.deltaTime;</span><br><span class="line">        <span class="keyword">this</span>.transform.Translate(direction);</span><br><span class="line">        ySpeed -= G * Time.deltaTime;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法三：使用Vector3 的方法<code>MoveTowards</code></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">method3</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> speed = <span class="number">200F</span>;   <span class="comment">//初速度</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> angle = <span class="number">60</span>;    <span class="comment">//起始方向与地面夹角    </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> G = <span class="number">9.8F</span>;     <span class="comment">//重力加速度</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> xSpeed;       <span class="comment">//x方向速度分量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> ySpeed;       <span class="comment">//y方向速度分量</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        xSpeed = speed * Mathf.Cos(angle / <span class="number">180</span> * Mathf.PI);</span><br><span class="line">        ySpeed = speed * Mathf.Sin(angle / <span class="number">180</span> * Mathf.PI);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Vector3 destation= <span class="keyword">this</span>.transform.position + (Vector3.right * xSpeed + Vector3.up * ySpeed) * Time.deltaTime;</span><br><span class="line">        <span class="keyword">this</span>.transform.position = Vector3.MoveTowards(<span class="keyword">this</span>.transform.position, destation, <span class="number">1</span>);</span><br><span class="line">        ySpeed -= G * Time.deltaTime;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<p>写一个程序，实现一个完整的太阳系， 其他星球围绕太阳的转速必须不一样，且不在一个法平面上。</p>
</blockquote>
<p><a href="https://github.com/DanielXuuuuu/Unity3D-Learning/tree/master/Simulated_Solar_System" target="_blank" rel="noopener">项目地址</a></p>
<p><a href="https://www.bilibili.com/video/av68313777" target="_blank" rel="noopener">完整演示视频</a></p>
<p>以下简述实现过程：</p>
<ul>
<li><p>首先创建10个球对象：一个太阳，八个行星，以及一个月亮。八个行星为太阳的子对象，月亮为地球的子对象。</p>
<img src="/2019/09/16/3D-Game-Programming-Design-空间与运动/cenci.png">
</li>
<li><p>按照真实的太阳系设置各个星球的大小，位置，并用网上收集到的图片更改球的外观。</p>
<img src="/2019/09/16/3D-Game-Programming-Design-空间与运动/init.png">
</li>
<li><p>编写两个脚本，实现公转和自转:</p>
<p>公转：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RotateAroundOther</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Transform sun;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> speed = <span class="number">50</span>;</span><br><span class="line">    <span class="keyword">float</span> ry,rz;</span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        ry = Random.Range(<span class="number">30</span>, <span class="number">60</span>);</span><br><span class="line">        rz = Random.Range(<span class="number">-20</span>, <span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Vector3 axis = <span class="keyword">new</span> Vector3(<span class="number">0</span>, ry, rz);</span><br><span class="line">        <span class="keyword">this</span>.transform.RotateAround(sun.position, axis, speed * Time.deltaTime);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li><p>自转：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RotateAroundSelf</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Update is called once per frame</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>  &#123;</span><br><span class="line">      <span class="keyword">this</span>.transform.RotateAround(<span class="keyword">this</span>.transform.position, Vector3.up, <span class="number">1</span> * Time.deltaTime);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>将上述公转和自转代码赋给各个星球，设置好公转的转速和中心即可。至于为了使公转的法平面不同而设置的<code>ry = Random.Range(30, 60); rz = Random.Range(-20, 20);</code>，具体数值可以自己调整。到此，太阳系的基本功能就以实现了</p>
<ul>
<li><p>此外，我还增加了背景；实现了暂停和开始功能；为行星的运动添加了轨道，使得转动更加直观。</p>
</li>
<li><p>最终效果图：</p>
<img src="/2019/09/16/3D-Game-Programming-Design-空间与运动/sun.png">

</li>
</ul>
<h5 id="编程实践"><a href="#编程实践" class="headerlink" title="编程实践"></a>编程实践</h5><h6 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h6><p>阅读以下游戏脚本</p>
<blockquote>
<p>Priests and Devils</p>
<p>Priests and Devils is a puzzle game in which you will help the Priests and Devils to cross the river within the time limit. There are 3 priests and 3 devils at one side of the river. They all want to get to the other side of this river, but there is only one boat and this boat can only carry two persons each time. And there must be one person steering the boat from one side to the other side. In the flash game, you can click on them to move them and click the go button to move the boat to the other direction. If the priests are out numbered by the devils on either side of the river, they get killed and the game is over. You can try it in many &gt; ways. Keep all priests alive! Good luck!</p>
</blockquote>
<p><a href="http://www.flash-game.net/game/2535/priests-and-devils.html" target="_blank" rel="noopener">示例地址</a></p>
<blockquote>
<p>程序需要满足的要求：</p>
<ul>
<li>列出游戏中提及的事物（Objects）</li>
<li>用表格列出玩家动作表（规则表），注意，动作越少越好</li>
<li>请将游戏中对象做成预制</li>
<li>在 GenGameObjects 中创建长方形、正方形、球及其色彩代表游戏中的对象。</li>
<li>使用C#集合类型有效组织对象</li>
<li>整个游戏仅主摄像机和一个 Empty 对象，<strong>其他对象必须代码动态生成！！！</strong> 。 整个游戏不许出现 Find 游戏对象， SendMessage 这类突破程序结构的通讯耦合语句。 <strong>违背本条准则，不给分</strong></li>
<li>请使用课件架构图编程，<strong>不接受非 MVC 结构程序</strong></li>
<li>注意细节，例如：船未靠岸，牧师与魔鬼上下船运动中，均不能接受用户事件！</li>
</ul>
</blockquote>
<p>游戏中提及的事物</p>
<ul>
<li>魔鬼</li>
<li>牧师</li>
<li>船</li>
<li>河流</li>
<li>河两岸</li>
</ul>
<p>玩家动作表（规则表）</p>
<table>
<thead>
<tr>
<th align="center">条件</th>
<th align="center">动作</th>
<th align="center">结果</th>
</tr>
</thead>
<tbody><tr>
<td align="center">船停靠在岸边时</td>
<td align="center">点击与船同侧的人物（牧师/魔鬼）</td>
<td align="center">人物跳进船或跳回岸边</td>
</tr>
<tr>
<td align="center">船停靠在岸边且船上有人时</td>
<td align="center">点击GO按钮</td>
<td align="center">船驶向对岸</td>
</tr>
<tr>
<td align="center">游戏胜利或失败后</td>
<td align="center">点击Restart按钮</td>
<td align="center">重新开始游戏</td>
</tr>
</tbody></table>
<h6 id="游戏分析与前期准备"><a href="#游戏分析与前期准备" class="headerlink" title="游戏分析与前期准备"></a>游戏分析与前期准备</h6><ul>
<li><p>按照题中要求，游戏的设计采用MVC（Model - View - Controller）结构模式，并遵循课程中老师给出的设计框架，如下图所示：</p>
<img src="/2019/09/16/3D-Game-Programming-Design-空间与运动/MVC.png">
</li>
<li><p>由于要求游戏对象要动态生成，所以要预先把各种游戏对象制作成预制，放在<code>Assets/Resources/Perfabs</code>文件夹中，当游戏启动时通过场景控制器执行<code>LoadResources</code>函数实例化。</p>
</li>
<li><p>从Assert Store中下载(白嫖)游戏模型，还是有很多免费但精美的模型的，有些还自带了动作。</p>
</li>
<li><p>在模拟好整个场景，预先排练并记下每个游戏对象的合适位置后，我们就可以用代码来动态生成他们了，并为它们赋予各自的逻辑。</p>
</li>
<li><p>因为牧师与恶魔的行为基本一致，所以我们可以归为一类考虑，并且用数组存储其对象，便于组织和管理。</p>
</li>
</ul>
<h6 id="代码实例"><a href="#代码实例" class="headerlink" title="代码实例"></a>代码实例</h6><p>由于源代码过长，就不全部贴出来了，这里只展示一些关键函数。详细的可以见我的Github(在下面给出了)。</p>
<ul>
<li>首先是导演类，比较简单，就是单例…不说了。</li>
</ul>
<p>然后我先完成了Model层的设计，因为Model较为底层，个人认为类似于建筑的地基。在Model层中，需要完成对每一类游戏对象属性、行为的定义。对于此游戏，我一共定义了role、boat、land、river四个模型，各自封装到一个类中。</p>
<ul>
<li>role类</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RoleModel</span></span><br><span class="line">&#123;</span><br><span class="line">    GameObject role;</span><br><span class="line">    <span class="keyword">bool</span> good;</span><br><span class="line">    <span class="keyword">bool</span> onBoat;</span><br><span class="line">    <span class="keyword">int</span> side;</span><br><span class="line">    Click click;      </span><br><span class="line">    Move move;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RoleModel</span>(<span class="params"><span class="keyword">string</span> roleType</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        onBoat = <span class="literal">false</span>;</span><br><span class="line">        side = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (roleType == <span class="string">"priest"</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            role = Object.Instantiate(</span><br><span class="line">                               Resources.Load&lt;GameObject&gt;(<span class="string">"Prefabs/Priest"</span>),</span><br><span class="line">                               Vector3.zero, Quaternion.Euler(<span class="number">0</span>, <span class="number">270</span>, <span class="number">0</span>));</span><br><span class="line">            good = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (roleType == <span class="string">"devil"</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            role = Object.Instantiate(</span><br><span class="line">                                Resources.Load&lt;GameObject&gt;(<span class="string">"Prefabs/Devil"</span>),</span><br><span class="line">                                Vector3.zero, Quaternion.Euler(<span class="number">0</span>, <span class="number">270</span>, <span class="number">0</span>));</span><br><span class="line">            good = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        move = role.AddComponent(<span class="keyword">typeof</span>(Move)) <span class="keyword">as</span> Move;</span><br><span class="line">        click = role.AddComponent(<span class="keyword">typeof</span>(Click)) <span class="keyword">as</span> Click;</span><br><span class="line">        click.SetRole(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Reset</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        side = <span class="number">1</span>;</span><br><span class="line">        role.transform.parent = <span class="literal">null</span>;</span><br><span class="line">        onBoat = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//下面Attack、Idle、Lose三个函数为恶魔专属，用于设置恶魔动画，似乎有些不符合role的设定，用继承可能好一点</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Attack</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Animator anim = role.GetComponent&lt;Animator&gt;();</span><br><span class="line">        anim.SetBool(<span class="string">"attack"</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Idle</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Animator anim = role.GetComponent&lt;Animator&gt;();</span><br><span class="line">        anim.SetBool(<span class="string">"attack"</span>, <span class="literal">false</span>);</span><br><span class="line">        anim.SetBool(<span class="string">"lose"</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Lose</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Animator anim = role.GetComponent&lt;Animator&gt;();</span><br><span class="line">        anim.SetBool(<span class="string">"lose"</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">IsGood</span>(<span class="params"></span>)</span> &#123; <span class="keyword">return</span> good; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">IsMoving</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> move.IsMoving();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">GetName</span>(<span class="params"></span>)</span> &#123; <span class="keyword">return</span> role.name; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetName</span>(<span class="params"><span class="keyword">string</span> name</span>)</span> &#123; role.name = name; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">GetSide</span>(<span class="params"></span>)</span> &#123; <span class="keyword">return</span> side; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetSide</span>(<span class="params"><span class="keyword">int</span> s = <span class="number">0</span></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span>(s != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            side = s;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            side = <span class="number">0</span> - side;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ChangeDirction</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (side == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            role.transform.rotation = Quaternion.Euler(<span class="number">0</span>, <span class="number">270</span>, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            role.transform.rotation = Quaternion.Euler(<span class="number">0</span>, <span class="number">90</span>, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">IsOnBoat</span>(<span class="params"></span>)</span> &#123; <span class="keyword">return</span> onBoat; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetPosition</span>(<span class="params">Vector3 pos</span>)</span> &#123; role.transform.position = pos; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Vector3 <span class="title">getPosition</span>(<span class="params"></span>)</span> &#123; <span class="keyword">return</span> role.transform.position; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Move</span>(<span class="params">Vector3 position</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        move.setPosition(position);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GoLand</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        role.transform.parent = <span class="literal">null</span>;</span><br><span class="line">        onBoat = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GoBoat</span>(<span class="params">BoatModel boat</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        role.transform.parent = boat.GetBoat().transform;</span><br><span class="line">        onBoat = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>boat类：</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BoatModel</span></span><br><span class="line">&#123;</span><br><span class="line">    GameObject boat;</span><br><span class="line">    <span class="comment">//bool moving; //船是否在运动</span></span><br><span class="line">    <span class="keyword">int</span> side; <span class="comment">//1表示在右边，-1表示在左边</span></span><br><span class="line">    Vector3 rightPosition = <span class="keyword">new</span> Vector3(<span class="number">3</span>, <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line">    Vector3 leftPosition = <span class="keyword">new</span> Vector3(<span class="number">-3</span>, <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line">    Vector3[] rightPositions = <span class="keyword">new</span> Vector3[] &#123; <span class="keyword">new</span> Vector3(<span class="number">2.5F</span>, <span class="number">-0.8F</span>, <span class="number">0</span>), <span class="keyword">new</span> Vector3(<span class="number">3.5F</span>, <span class="number">-0.8F</span>, <span class="number">0</span>) &#125;;</span><br><span class="line">    Vector3[] leftPositions = <span class="keyword">new</span> Vector3[] &#123; <span class="keyword">new</span> Vector3(<span class="number">-2.5F</span>, <span class="number">-0.8F</span>, <span class="number">0</span>), <span class="keyword">new</span> Vector3(<span class="number">-3.5F</span>, <span class="number">-0.8F</span>, <span class="number">0</span>) &#125;;</span><br><span class="line">    RoleModel[] passengers = <span class="keyword">new</span> RoleModel[<span class="number">2</span>];</span><br><span class="line">    Move move;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BoatModel</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">//初始船在右边</span></span><br><span class="line">        side = <span class="number">1</span>;</span><br><span class="line">        boat = Object.Instantiate(</span><br><span class="line">                                Resources.Load&lt;GameObject&gt;(<span class="string">"Prefabs/Boat"</span>),</span><br><span class="line">                                <span class="keyword">new</span> Vector3(<span class="number">3</span>, <span class="number">-1</span>, <span class="number">0</span>), Quaternion.Euler(<span class="number">0</span>, <span class="number">270</span>, <span class="number">0</span>));</span><br><span class="line">        boat.name = <span class="string">"boat"</span>;</span><br><span class="line">        move = boat.AddComponent(<span class="keyword">typeof</span>(Move)) <span class="keyword">as</span> Move;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++)</span><br><span class="line">            passengers[i] = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">GetSide</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> side;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ChangeDirction</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span>(side == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            boat.transform.rotation = Quaternion.Euler(<span class="number">0</span>, <span class="number">270</span>, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            boat.transform.rotation = Quaternion.Euler(<span class="number">0</span>, <span class="number">90</span>, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">IsEmpty</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++)</span><br><span class="line">            <span class="keyword">if</span> (passengers[i] != <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">IsFull</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++)</span><br><span class="line">            <span class="keyword">if</span> (passengers[i] == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">IsMoving</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> move.IsMoving();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Reset</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        side = <span class="number">1</span>;</span><br><span class="line">        boat.transform.position = <span class="keyword">new</span> Vector3(<span class="number">3</span>, <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line">        move.setPosition(leftPosition);</span><br><span class="line">        move.SetMoveSate(<span class="number">0</span>);</span><br><span class="line">        passengers = <span class="keyword">new</span> RoleModel[<span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Move</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span>(side == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            move.setPosition(leftPosition);</span><br><span class="line">            side = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            move.setPosition(rightPosition);</span><br><span class="line">            side = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//同时改变role的side</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (passengers[i] != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                passengers[i].SetSide();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">GetEmptyIndex</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; passengers.Length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (passengers[i] == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Vector3 <span class="title">getEmptyPosition</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Vector3 pos;</span><br><span class="line">        <span class="keyword">int</span> emptyIndex = GetEmptyIndex();</span><br><span class="line">        <span class="keyword">if</span> (side == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            pos = rightPositions[emptyIndex];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            pos = leftPositions[emptyIndex];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pos;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> GameObject <span class="title">GetBoat</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> boat;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddPassenger</span>(<span class="params">RoleModel passenger</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!IsFull()) </span><br><span class="line">            passengers[GetEmptyIndex()] = passenger;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RoleModel <span class="title">DeletePassenger</span>(<span class="params">RoleModel passenger</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++)</span><br><span class="line">            <span class="keyword">if</span> (passengers[i] != <span class="literal">null</span> &amp;&amp; passengers[i].GetName() == passenger.GetName())</span><br><span class="line">            &#123;</span><br><span class="line">                RoleModel role = passengers[i];</span><br><span class="line">                passengers[i] = <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">return</span> role;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RoleModel[] <span class="title">GetPassengers</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> passengers;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>河岸land类以及河river类都没什么特别的，因为它们都没有什么行为，只需要简单的初始化即可，这里就不展示了。</p>
<p>但光有对象不行，我们还需要给它们附加行为，才可以让他们动起来，同时还需要使role响应玩家鼠标的点击。就有了下面的Move和Click类。观察之前的role类，我们可以发现在初始化boat和role时，我们就实例化了这两个类，并作为组件(Component)附加到了游戏对象上，类似之前直接创建的脚本。</p>
<ul>
<li>Move类</li>
</ul>
<p>Move类实现游戏对象的平滑移动，主要依靠的是内置的<code>MoveToward</code>函数，在每次``Update`时都会执行，使得对象逐渐朝目的地移动。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Move</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">float</span> speed = <span class="number">4</span>;  <span class="comment">//移动速度</span></span><br><span class="line">    Vector3 endPosition, middlePosition;</span><br><span class="line">    <span class="keyword">int</span> moveState = <span class="number">0</span>;  <span class="comment">//0表示不移动, 1表示水平移动，2表示竖直移动</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetMoveSate</span>(<span class="params"><span class="keyword">int</span> state</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        moveState = state;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">IsMoving</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> moveState != <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPosition</span>(<span class="params">Vector3 position</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        endPosition = position;</span><br><span class="line">        <span class="keyword">if</span> (position.y == transform.position.y)         <span class="comment">//y值不变：船的移动</span></span><br><span class="line">        &#123;</span><br><span class="line">            SetMoveSate(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (position.y &lt; transform.position.y)      <span class="comment">//y值减小：角色从陆地到船</span></span><br><span class="line">            &#123;</span><br><span class="line">                middlePosition = <span class="keyword">new</span> Vector3(position.x, transform.position.y, position.z);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>                                          <span class="comment">//y值增大：角色从船到陆地</span></span><br><span class="line">            &#123;</span><br><span class="line">                middlePosition = <span class="keyword">new</span> Vector3(transform.position.x, position.y, position.z);</span><br><span class="line">            &#125;</span><br><span class="line">            SetMoveSate(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (moveState == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            transform.position = Vector3.MoveTowards(transform.position, middlePosition, speed * Time.deltaTime);</span><br><span class="line">            <span class="keyword">if</span> (transform.position == middlePosition)</span><br><span class="line">                SetMoveSate(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (moveState == <span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            transform.position = Vector3.MoveTowards(transform.position, endPosition, speed * Time.deltaTime);</span><br><span class="line">            <span class="keyword">if</span> (transform.position == endPosition)</span><br><span class="line">                SetMoveSate(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Click类</li>
</ul>
<p>Click类绑定一个相关的role对象，通过<code>OnMouseDown</code>函数实现响应鼠标点击，执行相关动作。</p>
<p>值得注意的是，要想OnMouseDown函数工作，还需要给游戏对象添加碰撞体(Collider)才行。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Click</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    IUserAction action;</span><br><span class="line">    RoleModel role;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetRole</span>(<span class="params">RoleModel r</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        role = r;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        action = SSDirector.GetInstance().CurrentSceneController <span class="keyword">as</span> IUserAction;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnMouseDown</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (role == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        action.MoveRole(role);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在Model层就基本完成了。我们再来考虑View层，即游戏与玩家的交互，我们需要为玩家提供什么交互功能。</p>
<ul>
<li>IUserAction</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IUserAction</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">MoveBoat</span>(<span class="params"></span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">MoveRole</span>(<span class="params">RoleModel role</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Check</span>(<span class="params"></span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Restart</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>UserGUI:</li>
</ul>
<p>由于我们的FirstSceneController也实现了IUserACtion接口，相当于控制器帮助玩家实现了指定的工作。所以我们在UserGUI中，只需要得到这个控制器，当玩家进行某个操作时，调用控制器的接口函数即可。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UserGUI</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> IUserAction action;</span><br><span class="line">    <span class="keyword">int</span> sign = <span class="number">0</span>; <span class="comment">//0：游戏进行中， 1：游戏胜利  -1：游戏失败</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        action = SSDirector.GetInstance().CurrentSceneController <span class="keyword">as</span> IUserAction;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnGUI</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        GUIStyle text_style;</span><br><span class="line">        GUIStyle button_style;</span><br><span class="line">        text_style = <span class="keyword">new</span> GUIStyle()</span><br><span class="line">        &#123;</span><br><span class="line">            fontSize = <span class="number">30</span></span><br><span class="line">        &#125;;</span><br><span class="line">        button_style = <span class="keyword">new</span> GUIStyle(<span class="string">"button"</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            fontSize = <span class="number">15</span></span><br><span class="line">        &#125;;</span><br><span class="line">        sign = action.Check();</span><br><span class="line">        <span class="keyword">if</span> (sign == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">30</span>, <span class="number">80</span>, <span class="number">60</span>, <span class="number">60</span>), <span class="string">"Go!"</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                action.MoveBoat();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(sign == <span class="number">-1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            GUI.Label(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">75</span>, <span class="number">100</span>, <span class="number">120</span>, <span class="number">50</span>), <span class="string">"You Failed!"</span>, text_style);</span><br><span class="line">            <span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">50</span>, <span class="number">150</span>, <span class="number">100</span>, <span class="number">50</span>), <span class="string">"Try Agian"</span>, button_style))</span><br><span class="line">            &#123;</span><br><span class="line">                action.Restart();</span><br><span class="line">                sign = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(sign == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            GUI.Label(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">60</span>, <span class="number">100</span>, <span class="number">120</span>, <span class="number">50</span>), <span class="string">"You Win!"</span>, text_style);</span><br><span class="line">            <span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">50</span>, <span class="number">150</span>, <span class="number">100</span>, <span class="number">50</span>), <span class="string">"Restart"</span>, button_style))</span><br><span class="line">            &#123;</span><br><span class="line">                action.Restart();</span><br><span class="line">                sign = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后我们完成Controller层，将之前的两层衔接起来。这里实现的是FirstController类，主要完成了加载资源，移动人物和船，判断游戏是否结束等功能。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FirstController</span> : <span class="title">MonoBehaviour</span>, <span class="title">ISceneController</span>, <span class="title">IUserAction</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> RoleModel[] Priests = <span class="keyword">new</span> RoleModel[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">public</span> RoleModel[] Devils = <span class="keyword">new</span> RoleModel[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">public</span> RiverModel River;</span><br><span class="line">    <span class="keyword">public</span> LandModel RightLand;</span><br><span class="line">    <span class="keyword">public</span> LandModel LeftLand;</span><br><span class="line">    <span class="keyword">public</span> BoatModel Boat;</span><br><span class="line">    Vector3[] PrisetsOriginPositions = <span class="keyword">new</span> Vector3[] &#123; <span class="keyword">new</span> Vector3(<span class="number">5F</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="keyword">new</span> Vector3(<span class="number">5.5F</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="keyword">new</span> Vector3(<span class="number">6F</span>, <span class="number">0</span>, <span class="number">0</span>) &#125;;</span><br><span class="line">    Vector3[] DevilsOriginPositions = <span class="keyword">new</span> Vector3[] &#123; <span class="keyword">new</span> Vector3(<span class="number">7F</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="keyword">new</span> Vector3(<span class="number">7.5F</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="keyword">new</span> Vector3(<span class="number">8F</span>, <span class="number">0</span>, <span class="number">0</span>) &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> gaming = <span class="literal">true</span>; <span class="comment">//用于判断游戏是否正在进行，由于目前还不存在起始界面，所以一开始游戏就开始了</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        SSDirector director = SSDirector.GetInstance();</span><br><span class="line">        <span class="comment">//director.setFPS(60);</span></span><br><span class="line">        director.CurrentSceneController = <span class="keyword">this</span>;</span><br><span class="line">        director.CurrentSceneController.LoadResource();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">LoadResource</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            RoleModel priest = <span class="keyword">new</span> RoleModel(<span class="string">"priest"</span>);</span><br><span class="line">            priest.SetName(<span class="string">"priest"</span> + i);</span><br><span class="line">            priest.SetPosition(<span class="keyword">new</span> Vector3(<span class="number">5</span> + i * <span class="number">0.5F</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">            Priests[i] = priest;</span><br><span class="line"></span><br><span class="line">            RoleModel devil = <span class="keyword">new</span> RoleModel(<span class="string">"devil"</span>);</span><br><span class="line">            devil.SetName(<span class="string">"devil"</span> + i);</span><br><span class="line">            devil.SetPosition(<span class="keyword">new</span> Vector3(<span class="number">7</span> + i * <span class="number">0.5F</span>, <span class="number">-0.1F</span>, <span class="number">0</span>));</span><br><span class="line">            devil.Idle();</span><br><span class="line">            Devils[i] = devil;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        RightLand = <span class="keyword">new</span> LandModel(<span class="string">"right"</span>);</span><br><span class="line">        LeftLand = <span class="keyword">new</span> LandModel(<span class="string">"left"</span>);</span><br><span class="line">        River = <span class="keyword">new</span> RiverModel();</span><br><span class="line">        Boat = <span class="keyword">new</span> BoatModel();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Restart</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            Priests[i].Reset();</span><br><span class="line">            Priests[i].SetPosition(PrisetsOriginPositions[i]);</span><br><span class="line">            Devils[i].Reset();</span><br><span class="line">            Devils[i].SetPosition(DevilsOriginPositions[i]);</span><br><span class="line">            Devils[i].Idle();</span><br><span class="line">        &#125;</span><br><span class="line">        Boat.Reset();</span><br><span class="line">        gaming = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">Check</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">//等船停下来再check</span></span><br><span class="line">        <span class="keyword">if</span> (Boat.IsMoving())</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Boat.ChangeDirction();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//计算两边的牧师和恶魔数量</span></span><br><span class="line">        <span class="keyword">int</span> rightPriestNum = <span class="number">0</span>, leftPriestNum = <span class="number">0</span>, rightDevilNum = <span class="number">0</span>, leftDevilNum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            Priests[i].ChangeDirction();</span><br><span class="line">            Devils[i].ChangeDirction();</span><br><span class="line">            <span class="keyword">if</span>(Priests[i].GetSide() == <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                rightPriestNum++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                leftPriestNum++;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (Devils[i].GetSide() == <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                rightDevilNum++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                leftDevilNum++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (leftPriestNum + leftDevilNum == <span class="number">6</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                Devils[i].Lose();</span><br><span class="line">            &#125;</span><br><span class="line">            gaming = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">//win</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((leftPriestNum &gt; <span class="number">0</span> &amp;&amp; leftDevilNum &gt; leftPriestNum) || (rightPriestNum &gt; <span class="number">0</span> &amp;&amp; rightDevilNum &gt; rightPriestNum))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> attackSide;</span><br><span class="line">            <span class="keyword">if</span> (leftDevilNum &gt; leftPriestNum)</span><br><span class="line">                attackSide = <span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                attackSide = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(Devils[i].GetSide() == attackSide)</span><br><span class="line">                    Devils[i].Attack();</span><br><span class="line">            &#125;</span><br><span class="line">            gaming = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>; <span class="comment">//lose</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">//continue</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MoveRole</span>(<span class="params">RoleModel role</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!gaming)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">//当其他角色还在移动时，不允许移动</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (Priests[i].IsMoving() || Devils[i].IsMoving())</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果还在前进，return</span></span><br><span class="line">        <span class="keyword">if</span> (Boat.IsMoving())</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (role.IsOnBoat())        <span class="comment">//上岸</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//这里，为了和原游戏一致，使牧师和魔鬼在两边的排列顺序一致</span></span><br><span class="line">            role = Boat.DeletePassenger(role);</span><br><span class="line">            Vector3 direction;</span><br><span class="line">            <span class="keyword">int</span> id = role.GetName()[role.GetName().Length - <span class="number">1</span>] - <span class="string">'0'</span>;</span><br><span class="line">            <span class="keyword">if</span> (role.IsGood())</span><br><span class="line">            &#123;</span><br><span class="line">                direction = PrisetsOriginPositions[id];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                direction = DevilsOriginPositions[id];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(role.GetSide() == <span class="number">-1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                direction.x = <span class="number">0</span> - direction.x;</span><br><span class="line">            &#125;</span><br><span class="line">            role.Move(direction);</span><br><span class="line">            role.GoLand();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>                        <span class="comment">//上船</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (Boat.IsFull() || Boat.GetSide() != role.GetSide())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            role.Move(Boat.getEmptyPosition());</span><br><span class="line">            role.GoBoat(Boat);</span><br><span class="line">            Boat.AddPassenger(role);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MoveBoat</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">//当船为空，或者船已经在动时，不允许移动船</span></span><br><span class="line">        <span class="keyword">if</span> (!Boat.IsEmpty() &amp;&amp; !Boat.IsMoving())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//当角色还在移动时，不允许移动船</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (Priests[i].IsMoving() || Devils[i].IsMoving())</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Boat.Move();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>完成上述代码后，游戏的逻辑也基本完成了。</p>
<h6 id="细节部分"><a href="#细节部分" class="headerlink" title="细节部分"></a>细节部分</h6><ul>
<li>船未靠岸，牧师与魔鬼上下船运动中，均不能接受用户事件：只需要在UserAction的函数中判断Move类中的state即可(具体代码见上面)，如果state表明正在移动，则直接返回，不进行任何操作。</li>
<li>同样的，当游戏胜利或者失败后，同样不能接受除了Restart以外的任何用户事件。</li>
</ul>
<h6 id="模型动作"><a href="#模型动作" class="headerlink" title="模型动作"></a>模型动作</h6><p>在下载模型时，发现了模型好像自带有动画(Animator组件)，于是就上网查了以下如何给人物附加动画。大致就是创建一个Animator Controller，通过给模型创建状态，并为不同状态绑定不同的动画效果，状态之间的转换需要一些特定的条件，在代码中触发这些条件实现动画切换。</p>
<p>上述可能解释的不是很清楚，具体可以参考这个<a href="https://blog.csdn.net/ChinarCSDN/article/details/81437311" target="_blank" rel="noopener">博客</a></p>
<h6 id="游戏主界面"><a href="#游戏主界面" class="headerlink" title="游戏主界面"></a>游戏主界面</h6><img src="/2019/09/16/3D-Game-Programming-Design-空间与运动/p&d.png">

<p><a href="https://www.bilibili.com/video/av68331555" target="_blank" rel="noopener">完整游戏视频</a></p>
<p><a href="https://github.com/DanielXuuuuu/Unity3D-Learning/tree/master/Priests_and_Devils" target="_blank" rel="noopener">项目地址</a></p>
<h6 id="游戏优化"><a href="#游戏优化" class="headerlink" title="游戏优化"></a>游戏优化</h6><ul>
<li>人物的移动做的还是比较粗糙，特别是河岸和船之间的路，我参考了往届同学的思路，使用了一个中间点用于转折，但应该还可以有更好的实现。</li>
<li>可以模仿原游戏，增加计时功能；也可以在起始时增加选项，根据玩家选择的难度增加牧师与恶魔的数量，以增加游戏难度与趣味。</li>
<li>在开始和结束游戏时，制作额外的场景用于和玩家交互</li>
</ul>
<p>下次的作业还是这个游戏，希望可以完成一些上述提到的想法，欢迎关注后续文章。</p>
<h6 id="感想"><a href="#感想" class="headerlink" title="感想"></a>感想</h6><p>这应该算是一个比较完整的游戏了，整体做下来以后，感觉按这样的思路设计游戏的话，还是十分复杂的。虽然现在对于Unity的使用还只是停留在移动、旋转对象的层面，但即使这样一个逻辑十分简单的游戏，仍有很多细节需要去判断，需要制定好每个对象的行为和位置，否则很容易出现Bug，就更不用说那些复杂的游戏了，简直不敢想象。我自身对于MVC模式掌握的也不够熟练，很多函数写的也比较繁琐。</p>
<p>但整个游戏的制作过程还是很愉快的，特别是在Asset Store下载了一些模型后，对于把游戏做精美的欲望更加强烈了。模型的使用、模型动画机制的运用让我对于接下来的学习3D游戏设计以及Unity的使用更加期待了。</p>

    </div>

    
    
    
        
      
        <div id="reward-container">
  <div></div>
  <button id="reward-button" disable="enable" onclick="var qr = document.getElementById(&quot;qr&quot;); qr.style.display = (qr.style.display === 'none') ? 'block' : 'none';">
    打赏
  </button>
  <div id="qr" style="display: none;">
        
      
      <div style="display: inline-block">
        <img src="/images/wechatpay.jpg" alt="Daniel Xu 微信支付">
        <p>微信支付</p>
      </div>

  </div>
</div>

      

      <footer class="post-footer">
          
            
          
          <div class="post-tags">
            
              <a href="/tags/课程作业/" rel="tag"><i class="fa fa-tag"></i> 课程作业</a>
            
              <a href="/tags/Unity/" rel="tag"><i class="fa fa-tag"></i> Unity</a>
            
          </div>
          <div class="post-copyright">    
            
            <ul style="margin: 0.5em 0 0;
                                            padding: 0.5em 1em;
                                            border-left: 3px solid #ff1700;
                                            background-color: #f8f8f8;
                                            list-style: none;">
              <li class="post-copyright-author">
                  <strong>本文作者： </strong>Daniel Xu
              </li>
              <li class="post-copyright-link">
                <strong>本文链接：</strong>
                <a href="/2019/09/16/3D-Game-Programming-Design-空间与运动/" title="3D Game Programming & Design - 空间与运动">2019/09/16/3D-Game-Programming-Design-空间与运动/</a>
              </li>
              <li class="post-copyright-license">
                <strong>版权声明：</strong>
                本博客所有文章除特别声明外，均采用 <a href="http://creativecommons.org/licenses/by-nc-sa/3.0/cn/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0 CN</a> 许可协议。转载请注明出处！
              </li>
            </ul>
            
          </div>
        

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2019/09/12/初次接触Go语言/" rel="next" title="初次接触Go语言">
                  <i class="fa fa-chevron-left"></i> 初次接触Go语言
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2019/09/22/3D-Game-Programming-Design-游戏对象与图形基础/" rel="prev" title="3D-Game-Programming-Design-游戏对象与图形基础">
                  3D-Game-Programming-Design-游戏对象与图形基础 <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          
    
    <div class="comments" id="gitalk-container"></div>
  

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-5"><a class="nav-link" href="#简答并用程序验证"><span class="nav-number">1.</span> <span class="nav-text">简答并用程序验证</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#编程实践"><span class="nav-number">2.</span> <span class="nav-text">编程实践</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#要求"><span class="nav-number">2.1.</span> <span class="nav-text">要求</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#游戏分析与前期准备"><span class="nav-number">2.2.</span> <span class="nav-text">游戏分析与前期准备</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#代码实例"><span class="nav-number">2.3.</span> <span class="nav-text">代码实例</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#细节部分"><span class="nav-number">2.4.</span> <span class="nav-text">细节部分</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#模型动作"><span class="nav-number">2.5.</span> <span class="nav-text">模型动作</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#游戏主界面"><span class="nav-number">2.6.</span> <span class="nav-text">游戏主界面</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#游戏优化"><span class="nav-number">2.7.</span> <span class="nav-text">游戏优化</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#感想"><span class="nav-number">2.8.</span> <span class="nav-text">感想</span></a></li></ol></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/avatar.jpg"
      alt="Daniel Xu">
  <p class="site-author-name" itemprop="name">Daniel Xu</p>
  <div class="site-description" itemprop="description">Think twice, code once.</div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-categories">
        
          
            <a href="/categories/">
          
        
        
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
          
            <a href="/tags/">
          
        
        
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
          
        
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">标签</span>
        </a>
      </div>
    
  </nav>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://github.com/DanielXuuuuu" title="GitHub &rarr; https://github.com/DanielXuuuuu" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="https://blog.csdn.net/White3zz" title="CSDN &rarr; https://blog.csdn.net/White3zz" rel="noopener" target="_blank"><i class="fa fa-fw fa-crosshairs"></i>CSDN</a>
      </span>
    
      <span class="links-of-author-item">
      
      
        
      
      
        
      
        <a href="mailto:979223119@qq.com" title="E-Mail &rarr; mailto:979223119@qq.com" rel="noopener" target="_blank"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
      </span>
    
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Daniel Xu</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item-icon">
      <i class="fa fa-user"></i>
    </span>
    <span class="site-uv" title="总访客量">
      <span class="busuanzi-value" id="busuanzi_value_site_uv"></span>
    </span>
  
    <span class="post-meta-divider">|</span>
  
    <span class="post-meta-item-icon">
      <i class="fa fa-eye"></i>
    </span>
    <span class="site-pv" title="总访问量">
      <span class="busuanzi-value" id="busuanzi_value_site_pv"></span>
    </span>
  
</div>












        
      </div>
    </footer>
  </div>

  


    
  
  <script color='0,0,255' opacity='0.5' zIndex='-1' count='99' src="/lib/canvas-nest/canvas-nest.min.js"></script>
  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.3.0"></script><script src="/js/motion.js?v=7.3.0"></script>
<script src="/js/schemes/muse.js?v=7.3.0"></script>
<script src="/js/next-boot.js?v=7.3.0"></script>



  








  <script src="/js/local-search.js?v=7.3.0"></script>














  

  

  

  

<link rel="stylesheet" href="//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.css">

<script>
  NexT.utils.getScript('//cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js', () => {
    var gitalk = new Gitalk({
      clientID: 'e8a2555d351479c4f410',
      clientSecret: '09087135840054a93d97b280f718a2b59ae0e277',
      repo: 'DanielXuuuuu.github.io',
      owner: 'DanielXuuuuu',
      admin: ['DanielXuuuuu'],
      id: '31eb12a5727e7cb1b2d3095f7af4d43c',
        language: window.navigator.language || window.navigator.userLanguage,
      
      distractionFreeMode: 'true'
    });
    gitalk.render('gitalk-container');
  }, window.Gitalk);
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","model":{"jsonPath":"/live2dw/assets/hijiki.model.json"},"display":{"position":"right","width":150,"height":300,"hOffset":80,"vOffset":-50},"mobile":{"show":false},"log":false,"tagMode":false});</script></body>
</html>
