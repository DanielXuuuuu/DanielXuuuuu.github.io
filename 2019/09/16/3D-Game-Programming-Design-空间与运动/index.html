<!DOCTYPE html>
<html lang="zh-CN">
    <!-- title -->




<!-- keywords -->




<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta name="author" content="Daniel Xu">
    <meta name="renderer" content="webkit">
    <meta name="copyright" content="Daniel Xu">
    
    <meta name="keywords" content="front-end,study,blog">
    
    <meta name="description" content="Think twice, code once.">
    <meta http-equiv="Cache-control" content="no-cache">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>3D Game Programming &amp; Design - 空间与运动 · Daniel&#39;s Studio</title>
    <style type="text/css">
    @font-face {
        font-family: 'Oswald-Regular';
        src: url("/font/Oswald-Regular.ttf");
    }

    body {
        margin: 0;
    }

    header,
    footer,
    .back-top,
    .sidebar,
    .container,
    .site-intro-meta,
    .toc-wrapper {
        display: none;
    }

    .site-intro {
        position: relative;
        z-index: 3;
        width: 100%;
        /* height: 50vh; */
        overflow: hidden;
    }

    .site-intro-placeholder {
        position: absolute;
        z-index: -2;
        top: 0;
        left: 0;
        width: calc(100% + 300px);
        height: 100%;
        background: repeating-linear-gradient(-45deg, #444 0, #444 80px, #333 80px, #333 160px);
        background-position: center center;
        transform: translate3d(-226px, 0, 0);
        animation: gradient-move 2.5s ease-out 0s infinite;
    }

    @keyframes gradient-move {
        0% {
            transform: translate3d(-226px, 0, 0);
        }
        100% {
            transform: translate3d(0, 0, 0);
        }
    }

</style>

    <link rel="preload" href="/css/style.css?v=20180824" as="style" onload="this.onload=null;this.rel='stylesheet'">
    <link rel="stylesheet" href="/css/mobile.css?v=20180824" media="(max-width: 980px)">
    
    <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
    
    <!-- /*! loadCSS. [c]2017 Filament Group, Inc. MIT License */
/* This file is meant as a standalone workflow for
- testing support for link[rel=preload]
- enabling async CSS loading in browsers that do not support rel=preload
- applying rel preload css once loaded, whether supported or not.
*/ -->
<script>
(function( w ){
	"use strict";
	// rel=preload support test
	if( !w.loadCSS ){
		w.loadCSS = function(){};
	}
	// define on the loadCSS obj
	var rp = loadCSS.relpreload = {};
	// rel=preload feature support test
	// runs once and returns a function for compat purposes
	rp.support = (function(){
		var ret;
		try {
			ret = w.document.createElement( "link" ).relList.supports( "preload" );
		} catch (e) {
			ret = false;
		}
		return function(){
			return ret;
		};
	})();

	// if preload isn't supported, get an asynchronous load by using a non-matching media attribute
	// then change that media back to its intended value on load
	rp.bindMediaToggle = function( link ){
		// remember existing media attr for ultimate state, or default to 'all'
		var finalMedia = link.media || "all";

		function enableStylesheet(){
			link.media = finalMedia;
		}

		// bind load handlers to enable media
		if( link.addEventListener ){
			link.addEventListener( "load", enableStylesheet );
		} else if( link.attachEvent ){
			link.attachEvent( "onload", enableStylesheet );
		}

		// Set rel and non-applicable media type to start an async request
		// note: timeout allows this to happen async to let rendering continue in IE
		setTimeout(function(){
			link.rel = "stylesheet";
			link.media = "only x";
		});
		// also enable media after 3 seconds,
		// which will catch very old browsers (android 2.x, old firefox) that don't support onload on link
		setTimeout( enableStylesheet, 3000 );
	};

	// loop through link elements in DOM
	rp.poly = function(){
		// double check this to prevent external calls from running
		if( rp.support() ){
			return;
		}
		var links = w.document.getElementsByTagName( "link" );
		for( var i = 0; i < links.length; i++ ){
			var link = links[ i ];
			// qualify links to those with rel=preload and as=style attrs
			if( link.rel === "preload" && link.getAttribute( "as" ) === "style" && !link.getAttribute( "data-loadcss" ) ){
				// prevent rerunning on link
				link.setAttribute( "data-loadcss", true );
				// bind listeners to toggle media back
				rp.bindMediaToggle( link );
			}
		}
	};

	// if unsupported, run the polyfill
	if( !rp.support() ){
		// run once at least
		rp.poly();

		// rerun poly on an interval until onload
		var run = w.setInterval( rp.poly, 500 );
		if( w.addEventListener ){
			w.addEventListener( "load", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		} else if( w.attachEvent ){
			w.attachEvent( "onload", function(){
				rp.poly();
				w.clearInterval( run );
			} );
		}
	}


	// commonjs
	if( typeof exports !== "undefined" ){
		exports.loadCSS = loadCSS;
	}
	else {
		w.loadCSS = loadCSS;
	}
}( typeof global !== "undefined" ? global : this ) );
</script>

    <link rel="icon" href="/assets/favicon.ico">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js" as="script">
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js" as="script">
    <link rel="preload" href="/scripts/main.js" as="script">
    <link rel="preload" as="font" href="/font/Oswald-Regular.ttf" crossorigin>
    <link rel="preload" as="font" href="https://at.alicdn.com/t/font_327081_1dta1rlogw17zaor.woff" crossorigin>
    
    <!-- fancybox -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.2.5/jquery.fancybox.min.js" defer></script>
    <!-- 百度统计  -->
    
    <!-- 谷歌统计  -->
    
</head>

    
        <body class="post-body">
    
    
<header class="header">

    <div class="read-progress"></div>
    <div class="header-sidebar-menu">&#xe775;</div>
    <!-- post页的toggle banner  -->
    
    <div class="banner">
            <div class="blog-title">
                <a href="/" >Daniel&#39;s Studio.</a>
            </div>
            <div class="post-title">
                <a href="#" class="post-name">3D Game Programming & Design - 空间与运动</a>
            </div>
    </div>
    
    <a class="home-link" href=/>Daniel's Studio.</a>
</header>
    <div class="wrapper">
        <div class="site-intro" style="







height:50vh;
">
    
    <!-- 主页  -->
    
    
    <!-- 404页  -->
            
    <div class="site-intro-placeholder"></div>
    <div class="site-intro-img" style="background-image: url(/intro/post-bg.jpg)"></div>
    <div class="site-intro-meta">
        <!-- 标题  -->
        <h1 class="intro-title">
            <!-- 主页  -->
            
            3D Game Programming & Design - 空间与运动
            <!-- 404 -->
            
        </h1>
        <!-- 副标题 -->
        <p class="intro-subtitle">
            <!-- 主页副标题  -->
            
            
            <!-- 404 -->
            
        </p>
        <!-- 文章页meta -->
        
            <div class="post-intros">
                <!-- 文章页标签  -->
                
                    <div class= post-intro-tags >
    
        <a class="post-tag" href="javascript:void(0);" data-tags = "课程作业">课程作业</a>
    
        <a class="post-tag" href="javascript:void(0);" data-tags = "Unity">Unity</a>
    
</div>
                
                
                    <div class="post-intro-read">
                        <span>字数统计: <span class="post-count word-count">4.8k</span>阅读时长: <span class="post-count reading-time">22 min</span></span>
                    </div>
                
                <div class="post-intro-meta">
                    <span class="post-intro-calander iconfont-archer">&#xe676;</span>
                    <span class="post-intro-time">2019/09/16</span>
                    
                    <span id="busuanzi_container_page_pv" class="busuanzi-pv">
                        <span class="iconfont-archer">&#xe602;</span>
                        <span id="busuanzi_value_page_pv"></span>
                    </span>
                    
                    <span class="shareWrapper">
                        <span class="iconfont-archer shareIcon">&#xe71d;</span>
                        <span class="shareText">Share</span>
                        <ul class="shareList">
                            <li class="iconfont-archer share-qr" data-type="qr">&#xe75b;
                                <div class="share-qrcode"></div>
                            </li>
                            <li class="iconfont-archer" data-type="weibo">&#xe619;</li>
                            <li class="iconfont-archer" data-type="qzone">&#xe62e;</li>
                            <li class="iconfont-archer" data-type="twitter">&#xe634;</li>
                            <li class="iconfont-archer" data-type="facebook">&#xe67a;</li>
                        </ul>
                    </span>
                </div>
            </div>
        
    </div>
</div>
        <script>
 
  // get user agent
  var browser = {
    versions: function () {
      var u = window.navigator.userAgent;
      return {
        userAgent: u,
        trident: u.indexOf('Trident') > -1, //IE内核
        presto: u.indexOf('Presto') > -1, //opera内核
        webKit: u.indexOf('AppleWebKit') > -1, //苹果、谷歌内核
        gecko: u.indexOf('Gecko') > -1 && u.indexOf('KHTML') == -1, //火狐内核
        mobile: !!u.match(/AppleWebKit.*Mobile.*/), //是否为移动终端
        ios: !!u.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/), //ios终端
        android: u.indexOf('Android') > -1 || u.indexOf('Linux') > -1, //android终端或者uc浏览器
        iPhone: u.indexOf('iPhone') > -1 || u.indexOf('Mac') > -1, //是否为iPhone或者安卓QQ浏览器
        iPad: u.indexOf('iPad') > -1, //是否为iPad
        webApp: u.indexOf('Safari') == -1, //是否为web应用程序，没有头部与底部
        weixin: u.indexOf('MicroMessenger') == -1, //是否为微信浏览器
        uc: u.indexOf('UCBrowser') > -1 //是否为android下的UC浏览器
      };
    }()
  }
  console.log("userAgent:" + browser.versions.userAgent);

  // callback
  function fontLoaded() {
    console.log('font loaded');
    if (document.getElementsByClassName('site-intro-meta')) {
      document.getElementsByClassName('intro-title')[0].classList.add('intro-fade-in');
      document.getElementsByClassName('intro-subtitle')[0].classList.add('intro-fade-in');
      var postIntros = document.getElementsByClassName('post-intros')[0]
      if (postIntros) {
        postIntros.classList.add('post-fade-in');
      }
    }
  }

  // UC不支持跨域，所以直接显示
  function asyncCb(){
    if (browser.versions.uc) {
      console.log("UCBrowser");
      fontLoaded();
    } else {
      WebFont.load({
        custom: {
          families: ['Oswald-Regular']
        },
        loading: function () {  //所有字体开始加载
          // console.log('loading');
        },
        active: function () {  //所有字体已渲染
          fontLoaded();
        },
        inactive: function () { //字体预加载失败，无效字体或浏览器不支持加载
          console.log('inactive: timeout');
          fontLoaded();
        },
        timeout: 5000 // Set the timeout to two seconds
      });
    }
  }

  function asyncErr(){
    console.warn('script load from CDN failed, will load local script')
  }

  // load webfont-loader async, and add callback function
  function async(u, cb, err) {
    var d = document, t = 'script',
      o = d.createElement(t),
      s = d.getElementsByTagName(t)[0];
    o.src = u;
    if (cb) { o.addEventListener('load', function (e) { cb(null, e); }, false); }
    if (err) { o.addEventListener('error', function (e) { err(null, e); }, false); }
    s.parentNode.insertBefore(o, s);
  }

  var asyncLoadWithFallBack = function(arr, success, reject) {
      var currReject = function(){
        reject()
        arr.shift()
        if(arr.length)
          async(arr[0], success, currReject)
        }

      async(arr[0], success, currReject)
  }

  asyncLoadWithFallBack([
    "https://cdn.jsdelivr.net/npm/webfontloader@1.6.28/webfontloader.min.js", 
    "https://cdn.bootcss.com/webfont/1.6.28/webfontloader.js",
    "/lib/webfontloader.min.js"
  ], asyncCb, asyncErr)
</script>        
        <img class="loading" src="/assets/loading.svg" style="display: block; margin: 6rem auto 0 auto; width: 6rem; height: 6rem;" />
        <div class="container container-unloaded">
            <main class="main post-page">
    <article class="article-entry">
        <p>3D游戏编程的第三次作业：</p>
<ul>
<li><p>使用Unity模拟出了太阳系中的行星运动</p>
</li>
<li><p>采用MVC设计模式编写了一个小游戏：牧师与恶魔</p>
</li>
</ul>
<p><a href="https://pmlpml.github.io/unity3d-learning/03-space-and-motion" target="_blank" rel="noopener">课程主页</a></p>
<a id="more"></a>

<h5 id="简答并用程序验证"><a href="#简答并用程序验证" class="headerlink" title="简答并用程序验证"></a>简答并用程序验证</h5><blockquote>
<p>游戏对象运动的本质是什么？</p>
</blockquote>
<p>游戏对象运动的本质就是使用矩阵变换（平移、旋转、缩放）改变游戏对象的空间属性。</p>
<blockquote>
<p>请用三种方法以上方法，实现物体的抛物线运动。</p>
</blockquote>
<ul>
<li><p>方法一：运动分解。将抛物线运动分解为横向和纵向的运动叠加，直接修改物体的位置</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">method1</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> speed = <span class="number">200F</span>;   <span class="comment">//初速度</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> angle = <span class="number">60</span>;    <span class="comment">//起始方向与地面夹角    </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> G = <span class="number">9.8F</span>;     <span class="comment">//重力加速度</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> xSpeed;       <span class="comment">//x方向速度分量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> ySpeed;       <span class="comment">//y方向速度分量</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        xSpeed = speed * Mathf.Cos(angle / <span class="number">180</span> * Mathf.PI);</span><br><span class="line">        ySpeed = speed * Mathf.Sin(angle / <span class="number">180</span> * Mathf.PI);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">this</span>.transform.position += Vector3.right * Time.deltaTime * xSpeed;</span><br><span class="line">        <span class="keyword">this</span>.transform.position += Vector3.up * Time.deltaTime * ySpeed;</span><br><span class="line">        ySpeed -= G * Time.deltaTime;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法二：使用<code>Transform</code> 的方法 <code>Translate</code></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">method2</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> speed = <span class="number">200F</span>;   <span class="comment">//初速度</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> angle = <span class="number">60</span>;    <span class="comment">//起始方向与地面夹角    </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> G = <span class="number">9.8F</span>;     <span class="comment">//重力加速度</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> xSpeed;       <span class="comment">//x方向速度分量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> ySpeed;       <span class="comment">//y方向速度分量</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        xSpeed = speed * Mathf.Cos(angle / <span class="number">180</span> * Mathf.PI);</span><br><span class="line">        ySpeed = speed * Mathf.Sin(angle / <span class="number">180</span> * Mathf.PI);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Vector3 direction = (Vector3.right * xSpeed + Vector3.up * ySpeed) * Time.deltaTime;</span><br><span class="line">        <span class="keyword">this</span>.transform.Translate(direction);</span><br><span class="line">        ySpeed -= G * Time.deltaTime;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>方法三：使用Vector3 的方法<code>MoveTowards</code></p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">method3</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> speed = <span class="number">200F</span>;   <span class="comment">//初速度</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">float</span> angle = <span class="number">60</span>;    <span class="comment">//起始方向与地面夹角    </span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> G = <span class="number">9.8F</span>;     <span class="comment">//重力加速度</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> xSpeed;       <span class="comment">//x方向速度分量</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">float</span> ySpeed;       <span class="comment">//y方向速度分量</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        xSpeed = speed * Mathf.Cos(angle / <span class="number">180</span> * Mathf.PI);</span><br><span class="line">        ySpeed = speed * Mathf.Sin(angle / <span class="number">180</span> * Mathf.PI);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Vector3 destation= <span class="keyword">this</span>.transform.position + (Vector3.right * xSpeed + Vector3.up * ySpeed) * Time.deltaTime;</span><br><span class="line">        <span class="keyword">this</span>.transform.position = Vector3.MoveTowards(<span class="keyword">this</span>.transform.position, destation, <span class="number">1</span>);</span><br><span class="line">        ySpeed -= G * Time.deltaTime;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<blockquote>
<p>写一个程序，实现一个完整的太阳系， 其他星球围绕太阳的转速必须不一样，且不在一个法平面上。</p>
</blockquote>
<p><a href="https://github.com/DanielXuuuuu/Unity3D-Learning/tree/master/Simulated_Solar_System" target="_blank" rel="noopener">项目地址</a></p>
<p><a href="https://www.bilibili.com/video/av68313777" target="_blank" rel="noopener">完整演示视频</a></p>
<p>以下简述实现过程：</p>
<ul>
<li><p>首先创建10个球对象：一个太阳，八个行星，以及一个月亮。八个行星为太阳的子对象，月亮为地球的子对象。</p>
<img src="/2019/09/16/3D-Game-Programming-Design-空间与运动/cenci.png">
</li>
<li><p>按照真实的太阳系设置各个星球的大小，位置，并用网上收集到的图片更改球的外观。</p>
<img src="/2019/09/16/3D-Game-Programming-Design-空间与运动/init.png">
</li>
<li><p>编写两个脚本，实现公转和自转:</p>
<p>公转：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RotateAroundOther</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Transform sun;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> speed = <span class="number">50</span>;</span><br><span class="line">    <span class="keyword">float</span> ry,rz;</span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        ry = Random.Range(<span class="number">30</span>, <span class="number">60</span>);</span><br><span class="line">        rz = Random.Range(<span class="number">-20</span>, <span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Vector3 axis = <span class="keyword">new</span> Vector3(<span class="number">0</span>, ry, rz);</span><br><span class="line">        <span class="keyword">this</span>.transform.RotateAround(sun.position, axis, speed * Time.deltaTime);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
</ul>
<ul>
<li><p>自转：</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RotateAroundSelf</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// Update is called once per frame</span></span><br><span class="line">  <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>  &#123;</span><br><span class="line">      <span class="keyword">this</span>.transform.RotateAround(<span class="keyword">this</span>.transform.position, Vector3.up, <span class="number">1</span> * Time.deltaTime);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<p>将上述公转和自转代码赋给各个星球，设置好公转的转速和中心即可。至于为了使公转的法平面不同而设置的<code>ry = Random.Range(30, 60); rz = Random.Range(-20, 20);</code>，具体数值可以自己调整。到此，太阳系的基本功能就以实现了</p>
<ul>
<li><p>此外，我还增加了背景；实现了暂停和开始功能；为行星的运动添加了轨道，使得转动更加直观。</p>
</li>
<li><p>最终效果图：</p>
<img src="/2019/09/16/3D-Game-Programming-Design-空间与运动/sun.png">

</li>
</ul>
<h5 id="编程实践"><a href="#编程实践" class="headerlink" title="编程实践"></a>编程实践</h5><h6 id="要求"><a href="#要求" class="headerlink" title="要求"></a>要求</h6><p>阅读以下游戏脚本</p>
<blockquote>
<p>Priests and Devils</p>
<p>Priests and Devils is a puzzle game in which you will help the Priests and Devils to cross the river within the time limit. There are 3 priests and 3 devils at one side of the river. They all want to get to the other side of this river, but there is only one boat and this boat can only carry two persons each time. And there must be one person steering the boat from one side to the other side. In the flash game, you can click on them to move them and click the go button to move the boat to the other direction. If the priests are out numbered by the devils on either side of the river, they get killed and the game is over. You can try it in many &gt; ways. Keep all priests alive! Good luck!</p>
</blockquote>
<p><a href="http://www.flash-game.net/game/2535/priests-and-devils.html" target="_blank" rel="noopener">示例地址</a></p>
<blockquote>
<p>程序需要满足的要求：</p>
<ul>
<li>列出游戏中提及的事物（Objects）</li>
<li>用表格列出玩家动作表（规则表），注意，动作越少越好</li>
<li>请将游戏中对象做成预制</li>
<li>在 GenGameObjects 中创建长方形、正方形、球及其色彩代表游戏中的对象。</li>
<li>使用C#集合类型有效组织对象</li>
<li>整个游戏仅主摄像机和一个 Empty 对象，<strong>其他对象必须代码动态生成！！！</strong> 。 整个游戏不许出现 Find 游戏对象， SendMessage 这类突破程序结构的通讯耦合语句。 <strong>违背本条准则，不给分</strong></li>
<li>请使用课件架构图编程，<strong>不接受非 MVC 结构程序</strong></li>
<li>注意细节，例如：船未靠岸，牧师与魔鬼上下船运动中，均不能接受用户事件！</li>
</ul>
</blockquote>
<p>游戏中提及的事物</p>
<ul>
<li>魔鬼</li>
<li>牧师</li>
<li>船</li>
<li>河流</li>
<li>河两岸</li>
</ul>
<p>玩家动作表（规则表）</p>
<table>
<thead>
<tr>
<th align="center">条件</th>
<th align="center">动作</th>
<th align="center">结果</th>
</tr>
</thead>
<tbody><tr>
<td align="center">船停靠在岸边时</td>
<td align="center">点击与船同侧的人物（牧师/魔鬼）</td>
<td align="center">人物跳进船或跳回岸边</td>
</tr>
<tr>
<td align="center">船停靠在岸边且船上有人时</td>
<td align="center">点击GO按钮</td>
<td align="center">船驶向对岸</td>
</tr>
<tr>
<td align="center">游戏胜利或失败后</td>
<td align="center">点击Restart按钮</td>
<td align="center">重新开始游戏</td>
</tr>
</tbody></table>
<h6 id="游戏分析与前期准备"><a href="#游戏分析与前期准备" class="headerlink" title="游戏分析与前期准备"></a>游戏分析与前期准备</h6><ul>
<li><p>按照题中要求，游戏的设计采用MVC（Model - View - Controller）结构模式，并遵循课程中老师给出的设计框架，如下图所示：</p>
<img src="/2019/09/16/3D-Game-Programming-Design-空间与运动/MVC.png">
</li>
<li><p>由于要求游戏对象要动态生成，所以要预先把各种游戏对象制作成预制，放在<code>Assets/Resources/Perfabs</code>文件夹中，当游戏启动时通过场景控制器执行<code>LoadResources</code>函数实例化。</p>
</li>
<li><p>从Assert Store中下载(白嫖)游戏模型，还是有很多免费但精美的模型的，有些还自带了动作。</p>
</li>
<li><p>在模拟好整个场景，预先排练并记下每个游戏对象的合适位置后，我们就可以用代码来动态生成他们了，并为它们赋予各自的逻辑。</p>
</li>
<li><p>因为牧师与恶魔的行为基本一致，所以我们可以归为一类考虑，并且用数组存储其对象，便于组织和管理。</p>
</li>
</ul>
<h6 id="代码实例"><a href="#代码实例" class="headerlink" title="代码实例"></a>代码实例</h6><p>由于源代码过长，就不全部贴出来了，这里只展示一些关键函数。详细的可以见我的Github(在下面给出了)。</p>
<ul>
<li>首先是导演类，比较简单，就是单例…不说了。</li>
</ul>
<p>然后我先完成了Model层的设计，因为Model较为底层，个人认为类似于建筑的地基。在Model层中，需要完成对每一类游戏对象属性、行为的定义。对于此游戏，我一共定义了role、boat、land、river四个模型，各自封装到一个类中。</p>
<ul>
<li>role类</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RoleModel</span></span><br><span class="line">&#123;</span><br><span class="line">    GameObject role;</span><br><span class="line">    <span class="keyword">bool</span> good;</span><br><span class="line">    <span class="keyword">bool</span> onBoat;</span><br><span class="line">    <span class="keyword">int</span> side;</span><br><span class="line">    Click click;      </span><br><span class="line">    Move move;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RoleModel</span>(<span class="params"><span class="keyword">string</span> roleType</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        onBoat = <span class="literal">false</span>;</span><br><span class="line">        side = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (roleType == <span class="string">"priest"</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            role = Object.Instantiate(</span><br><span class="line">                               Resources.Load&lt;GameObject&gt;(<span class="string">"Prefabs/Priest"</span>),</span><br><span class="line">                               Vector3.zero, Quaternion.Euler(<span class="number">0</span>, <span class="number">270</span>, <span class="number">0</span>));</span><br><span class="line">            good = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (roleType == <span class="string">"devil"</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            role = Object.Instantiate(</span><br><span class="line">                                Resources.Load&lt;GameObject&gt;(<span class="string">"Prefabs/Devil"</span>),</span><br><span class="line">                                Vector3.zero, Quaternion.Euler(<span class="number">0</span>, <span class="number">270</span>, <span class="number">0</span>));</span><br><span class="line">            good = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        move = role.AddComponent(<span class="keyword">typeof</span>(Move)) <span class="keyword">as</span> Move;</span><br><span class="line">        click = role.AddComponent(<span class="keyword">typeof</span>(Click)) <span class="keyword">as</span> Click;</span><br><span class="line">        click.SetRole(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Reset</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        side = <span class="number">1</span>;</span><br><span class="line">        role.transform.parent = <span class="literal">null</span>;</span><br><span class="line">        onBoat = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//下面Attack、Idle、Lose三个函数为恶魔专属，用于设置恶魔动画，似乎有些不符合role的设定，用继承可能好一点</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Attack</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Animator anim = role.GetComponent&lt;Animator&gt;();</span><br><span class="line">        anim.SetBool(<span class="string">"attack"</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Idle</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Animator anim = role.GetComponent&lt;Animator&gt;();</span><br><span class="line">        anim.SetBool(<span class="string">"attack"</span>, <span class="literal">false</span>);</span><br><span class="line">        anim.SetBool(<span class="string">"lose"</span>, <span class="literal">false</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Lose</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Animator anim = role.GetComponent&lt;Animator&gt;();</span><br><span class="line">        anim.SetBool(<span class="string">"lose"</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">IsGood</span>(<span class="params"></span>)</span> &#123; <span class="keyword">return</span> good; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">IsMoving</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> move.IsMoving();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">string</span> <span class="title">GetName</span>(<span class="params"></span>)</span> &#123; <span class="keyword">return</span> role.name; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetName</span>(<span class="params"><span class="keyword">string</span> name</span>)</span> &#123; role.name = name; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">GetSide</span>(<span class="params"></span>)</span> &#123; <span class="keyword">return</span> side; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetSide</span>(<span class="params"><span class="keyword">int</span> s = <span class="number">0</span></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span>(s != <span class="number">0</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            side = s;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> </span><br><span class="line">            side = <span class="number">0</span> - side;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ChangeDirction</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (side == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            role.transform.rotation = Quaternion.Euler(<span class="number">0</span>, <span class="number">270</span>, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            role.transform.rotation = Quaternion.Euler(<span class="number">0</span>, <span class="number">90</span>, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">IsOnBoat</span>(<span class="params"></span>)</span> &#123; <span class="keyword">return</span> onBoat; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetPosition</span>(<span class="params">Vector3 pos</span>)</span> &#123; role.transform.position = pos; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> Vector3 <span class="title">getPosition</span>(<span class="params"></span>)</span> &#123; <span class="keyword">return</span> role.transform.position; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Move</span>(<span class="params">Vector3 position</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        move.setPosition(position);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GoLand</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        role.transform.parent = <span class="literal">null</span>;</span><br><span class="line">        onBoat = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">GoBoat</span>(<span class="params">BoatModel boat</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        role.transform.parent = boat.GetBoat().transform;</span><br><span class="line">        onBoat = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>boat类：</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BoatModel</span></span><br><span class="line">&#123;</span><br><span class="line">    GameObject boat;</span><br><span class="line">    <span class="comment">//bool moving; //船是否在运动</span></span><br><span class="line">    <span class="keyword">int</span> side; <span class="comment">//1表示在右边，-1表示在左边</span></span><br><span class="line">    Vector3 rightPosition = <span class="keyword">new</span> Vector3(<span class="number">3</span>, <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line">    Vector3 leftPosition = <span class="keyword">new</span> Vector3(<span class="number">-3</span>, <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line">    Vector3[] rightPositions = <span class="keyword">new</span> Vector3[] &#123; <span class="keyword">new</span> Vector3(<span class="number">2.5F</span>, <span class="number">-0.8F</span>, <span class="number">0</span>), <span class="keyword">new</span> Vector3(<span class="number">3.5F</span>, <span class="number">-0.8F</span>, <span class="number">0</span>) &#125;;</span><br><span class="line">    Vector3[] leftPositions = <span class="keyword">new</span> Vector3[] &#123; <span class="keyword">new</span> Vector3(<span class="number">-2.5F</span>, <span class="number">-0.8F</span>, <span class="number">0</span>), <span class="keyword">new</span> Vector3(<span class="number">-3.5F</span>, <span class="number">-0.8F</span>, <span class="number">0</span>) &#125;;</span><br><span class="line">    RoleModel[] passengers = <span class="keyword">new</span> RoleModel[<span class="number">2</span>];</span><br><span class="line">    Move move;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BoatModel</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">//初始船在右边</span></span><br><span class="line">        side = <span class="number">1</span>;</span><br><span class="line">        boat = Object.Instantiate(</span><br><span class="line">                                Resources.Load&lt;GameObject&gt;(<span class="string">"Prefabs/Boat"</span>),</span><br><span class="line">                                <span class="keyword">new</span> Vector3(<span class="number">3</span>, <span class="number">-1</span>, <span class="number">0</span>), Quaternion.Euler(<span class="number">0</span>, <span class="number">270</span>, <span class="number">0</span>));</span><br><span class="line">        boat.name = <span class="string">"boat"</span>;</span><br><span class="line">        move = boat.AddComponent(<span class="keyword">typeof</span>(Move)) <span class="keyword">as</span> Move;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++)</span><br><span class="line">            passengers[i] = <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">GetSide</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> side;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ChangeDirction</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span>(side == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            boat.transform.rotation = Quaternion.Euler(<span class="number">0</span>, <span class="number">270</span>, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            boat.transform.rotation = Quaternion.Euler(<span class="number">0</span>, <span class="number">90</span>, <span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">IsEmpty</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++)</span><br><span class="line">            <span class="keyword">if</span> (passengers[i] != <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">IsFull</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++)</span><br><span class="line">            <span class="keyword">if</span> (passengers[i] == <span class="literal">null</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">IsMoving</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> move.IsMoving();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Reset</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        side = <span class="number">1</span>;</span><br><span class="line">        boat.transform.position = <span class="keyword">new</span> Vector3(<span class="number">3</span>, <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line">        move.setPosition(leftPosition);</span><br><span class="line">        move.SetMoveSate(<span class="number">0</span>);</span><br><span class="line">        passengers = <span class="keyword">new</span> RoleModel[<span class="number">2</span>];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Move</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span>(side == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            move.setPosition(leftPosition);</span><br><span class="line">            side = <span class="number">-1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            move.setPosition(rightPosition);</span><br><span class="line">            side = <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//同时改变role的side</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (passengers[i] != <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                passengers[i].SetSide();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">GetEmptyIndex</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; passengers.Length; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (passengers[i] == <span class="literal">null</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> i;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Vector3 <span class="title">getEmptyPosition</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Vector3 pos;</span><br><span class="line">        <span class="keyword">int</span> emptyIndex = GetEmptyIndex();</span><br><span class="line">        <span class="keyword">if</span> (side == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            pos = rightPositions[emptyIndex];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            pos = leftPositions[emptyIndex];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pos;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> GameObject <span class="title">GetBoat</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> boat;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddPassenger</span>(<span class="params">RoleModel passenger</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!IsFull()) </span><br><span class="line">            passengers[GetEmptyIndex()] = passenger;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RoleModel <span class="title">DeletePassenger</span>(<span class="params">RoleModel passenger</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++)</span><br><span class="line">            <span class="keyword">if</span> (passengers[i] != <span class="literal">null</span> &amp;&amp; passengers[i].GetName() == passenger.GetName())</span><br><span class="line">            &#123;</span><br><span class="line">                RoleModel role = passengers[i];</span><br><span class="line">                passengers[i] = <span class="literal">null</span>;</span><br><span class="line">                <span class="keyword">return</span> role;</span><br><span class="line">            &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RoleModel[] <span class="title">GetPassengers</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> passengers;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>河岸land类以及河river类都没什么特别的，因为它们都没有什么行为，只需要简单的初始化即可，这里就不展示了。</p>
<p>但光有对象不行，我们还需要给它们附加行为，才可以让他们动起来，同时还需要使role响应玩家鼠标的点击。就有了下面的Move和Click类。观察之前的role类，我们可以发现在初始化boat和role时，我们就实例化了这两个类，并作为组件(Component)附加到了游戏对象上，类似之前直接创建的脚本。</p>
<ul>
<li>Move类</li>
</ul>
<p>Move类实现游戏对象的平滑移动，主要依靠的是内置的<code>MoveToward</code>函数，在每次``Update`时都会执行，使得对象逐渐朝目的地移动。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Move</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">float</span> speed = <span class="number">4</span>;  <span class="comment">//移动速度</span></span><br><span class="line">    Vector3 endPosition, middlePosition;</span><br><span class="line">    <span class="keyword">int</span> moveState = <span class="number">0</span>;  <span class="comment">//0表示不移动, 1表示水平移动，2表示竖直移动</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetMoveSate</span>(<span class="params"><span class="keyword">int</span> state</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        moveState = state;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">bool</span> <span class="title">IsMoving</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">return</span> moveState != <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPosition</span>(<span class="params">Vector3 position</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        endPosition = position;</span><br><span class="line">        <span class="keyword">if</span> (position.y == transform.position.y)         <span class="comment">//y值不变：船的移动</span></span><br><span class="line">        &#123;</span><br><span class="line">            SetMoveSate(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (position.y &lt; transform.position.y)      <span class="comment">//y值减小：角色从陆地到船</span></span><br><span class="line">            &#123;</span><br><span class="line">                middlePosition = <span class="keyword">new</span> Vector3(position.x, transform.position.y, position.z);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>                                          <span class="comment">//y值增大：角色从船到陆地</span></span><br><span class="line">            &#123;</span><br><span class="line">                middlePosition = <span class="keyword">new</span> Vector3(transform.position.x, position.y, position.z);</span><br><span class="line">            &#125;</span><br><span class="line">            SetMoveSate(<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (moveState == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            transform.position = Vector3.MoveTowards(transform.position, middlePosition, speed * Time.deltaTime);</span><br><span class="line">            <span class="keyword">if</span> (transform.position == middlePosition)</span><br><span class="line">                SetMoveSate(<span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (moveState == <span class="number">2</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            transform.position = Vector3.MoveTowards(transform.position, endPosition, speed * Time.deltaTime);</span><br><span class="line">            <span class="keyword">if</span> (transform.position == endPosition)</span><br><span class="line">                SetMoveSate(<span class="number">0</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>Click类</li>
</ul>
<p>Click类绑定一个相关的role对象，通过<code>OnMouseDown</code>函数实现响应鼠标点击，执行相关动作。</p>
<p>值得注意的是，要想OnMouseDown函数工作，还需要给游戏对象添加碰撞体(Collider)才行。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Click</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    IUserAction action;</span><br><span class="line">    RoleModel role;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SetRole</span>(<span class="params">RoleModel r</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        role = r;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        action = SSDirector.GetInstance().CurrentSceneController <span class="keyword">as</span> IUserAction;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnMouseDown</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (role == <span class="literal">null</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        action.MoveRole(role);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>现在Model层就基本完成了。我们再来考虑View层，即游戏与玩家的交互，我们需要为玩家提供什么交互功能。</p>
<ul>
<li>IUserAction</li>
</ul>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IUserAction</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">MoveBoat</span>(<span class="params"></span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">MoveRole</span>(<span class="params">RoleModel role</span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">Check</span>(<span class="params"></span>)</span>;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Restart</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>UserGUI:</li>
</ul>
<p>由于我们的FirstSceneController也实现了IUserACtion接口，相当于控制器帮助玩家实现了指定的工作。所以我们在UserGUI中，只需要得到这个控制器，当玩家进行某个操作时，调用控制器的接口函数即可。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">UserGUI</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> IUserAction action;</span><br><span class="line">    <span class="keyword">int</span> sign = <span class="number">0</span>; <span class="comment">//0：游戏进行中， 1：游戏胜利  -1：游戏失败</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        action = SSDirector.GetInstance().CurrentSceneController <span class="keyword">as</span> IUserAction;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">OnGUI</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        GUIStyle text_style;</span><br><span class="line">        GUIStyle button_style;</span><br><span class="line">        text_style = <span class="keyword">new</span> GUIStyle()</span><br><span class="line">        &#123;</span><br><span class="line">            fontSize = <span class="number">30</span></span><br><span class="line">        &#125;;</span><br><span class="line">        button_style = <span class="keyword">new</span> GUIStyle(<span class="string">"button"</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            fontSize = <span class="number">15</span></span><br><span class="line">        &#125;;</span><br><span class="line">        sign = action.Check();</span><br><span class="line">        <span class="keyword">if</span> (sign == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">30</span>, <span class="number">80</span>, <span class="number">60</span>, <span class="number">60</span>), <span class="string">"Go!"</span>))</span><br><span class="line">            &#123;</span><br><span class="line">                action.MoveBoat();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(sign == <span class="number">-1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            GUI.Label(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">75</span>, <span class="number">100</span>, <span class="number">120</span>, <span class="number">50</span>), <span class="string">"You Failed!"</span>, text_style);</span><br><span class="line">            <span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">50</span>, <span class="number">150</span>, <span class="number">100</span>, <span class="number">50</span>), <span class="string">"Try Agian"</span>, button_style))</span><br><span class="line">            &#123;</span><br><span class="line">                action.Restart();</span><br><span class="line">                sign = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span>(sign == <span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            GUI.Label(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">60</span>, <span class="number">100</span>, <span class="number">120</span>, <span class="number">50</span>), <span class="string">"You Win!"</span>, text_style);</span><br><span class="line">            <span class="keyword">if</span> (GUI.Button(<span class="keyword">new</span> Rect(Screen.width / <span class="number">2</span> - <span class="number">50</span>, <span class="number">150</span>, <span class="number">100</span>, <span class="number">50</span>), <span class="string">"Restart"</span>, button_style))</span><br><span class="line">            &#123;</span><br><span class="line">                action.Restart();</span><br><span class="line">                sign = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后我们完成Controller层，将之前的两层衔接起来。这里实现的是FirstController类，主要完成了加载资源，移动人物和船，判断游戏是否结束等功能。</p>
<figure class="highlight c#"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FirstController</span> : <span class="title">MonoBehaviour</span>, <span class="title">ISceneController</span>, <span class="title">IUserAction</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> RoleModel[] Priests = <span class="keyword">new</span> RoleModel[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">public</span> RoleModel[] Devils = <span class="keyword">new</span> RoleModel[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">public</span> RiverModel River;</span><br><span class="line">    <span class="keyword">public</span> LandModel RightLand;</span><br><span class="line">    <span class="keyword">public</span> LandModel LeftLand;</span><br><span class="line">    <span class="keyword">public</span> BoatModel Boat;</span><br><span class="line">    Vector3[] PrisetsOriginPositions = <span class="keyword">new</span> Vector3[] &#123; <span class="keyword">new</span> Vector3(<span class="number">5F</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="keyword">new</span> Vector3(<span class="number">5.5F</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="keyword">new</span> Vector3(<span class="number">6F</span>, <span class="number">0</span>, <span class="number">0</span>) &#125;;</span><br><span class="line">    Vector3[] DevilsOriginPositions = <span class="keyword">new</span> Vector3[] &#123; <span class="keyword">new</span> Vector3(<span class="number">7F</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="keyword">new</span> Vector3(<span class="number">7.5F</span>, <span class="number">0</span>, <span class="number">0</span>), <span class="keyword">new</span> Vector3(<span class="number">8F</span>, <span class="number">0</span>, <span class="number">0</span>) &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">bool</span> gaming = <span class="literal">true</span>; <span class="comment">//用于判断游戏是否正在进行，由于目前还不存在起始界面，所以一开始游戏就开始了</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Awake</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        SSDirector director = SSDirector.GetInstance();</span><br><span class="line">        <span class="comment">//director.setFPS(60);</span></span><br><span class="line">        director.CurrentSceneController = <span class="keyword">this</span>;</span><br><span class="line">        director.CurrentSceneController.LoadResource();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">LoadResource</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            RoleModel priest = <span class="keyword">new</span> RoleModel(<span class="string">"priest"</span>);</span><br><span class="line">            priest.SetName(<span class="string">"priest"</span> + i);</span><br><span class="line">            priest.SetPosition(<span class="keyword">new</span> Vector3(<span class="number">5</span> + i * <span class="number">0.5F</span>, <span class="number">0</span>, <span class="number">0</span>));</span><br><span class="line">            Priests[i] = priest;</span><br><span class="line"></span><br><span class="line">            RoleModel devil = <span class="keyword">new</span> RoleModel(<span class="string">"devil"</span>);</span><br><span class="line">            devil.SetName(<span class="string">"devil"</span> + i);</span><br><span class="line">            devil.SetPosition(<span class="keyword">new</span> Vector3(<span class="number">7</span> + i * <span class="number">0.5F</span>, <span class="number">-0.1F</span>, <span class="number">0</span>));</span><br><span class="line">            devil.Idle();</span><br><span class="line">            Devils[i] = devil;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        RightLand = <span class="keyword">new</span> LandModel(<span class="string">"right"</span>);</span><br><span class="line">        LeftLand = <span class="keyword">new</span> LandModel(<span class="string">"left"</span>);</span><br><span class="line">        River = <span class="keyword">new</span> RiverModel();</span><br><span class="line">        Boat = <span class="keyword">new</span> BoatModel();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Start is called before the first frame update</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Update is called once per frame</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Update</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Restart</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            Priests[i].Reset();</span><br><span class="line">            Priests[i].SetPosition(PrisetsOriginPositions[i]);</span><br><span class="line">            Devils[i].Reset();</span><br><span class="line">            Devils[i].SetPosition(DevilsOriginPositions[i]);</span><br><span class="line">            Devils[i].Idle();</span><br><span class="line">        &#125;</span><br><span class="line">        Boat.Reset();</span><br><span class="line">        gaming = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">Check</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">//等船停下来再check</span></span><br><span class="line">        <span class="keyword">if</span> (Boat.IsMoving())</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        Boat.ChangeDirction();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//计算两边的牧师和恶魔数量</span></span><br><span class="line">        <span class="keyword">int</span> rightPriestNum = <span class="number">0</span>, leftPriestNum = <span class="number">0</span>, rightDevilNum = <span class="number">0</span>, leftDevilNum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            Priests[i].ChangeDirction();</span><br><span class="line">            Devils[i].ChangeDirction();</span><br><span class="line">            <span class="keyword">if</span>(Priests[i].GetSide() == <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                rightPriestNum++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                leftPriestNum++;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (Devils[i].GetSide() == <span class="number">1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                rightDevilNum++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                leftDevilNum++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (leftPriestNum + leftDevilNum == <span class="number">6</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                Devils[i].Lose();</span><br><span class="line">            &#125;</span><br><span class="line">            gaming = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>; <span class="comment">//win</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((leftPriestNum &gt; <span class="number">0</span> &amp;&amp; leftDevilNum &gt; leftPriestNum) || (rightPriestNum &gt; <span class="number">0</span> &amp;&amp; rightDevilNum &gt; rightPriestNum))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">int</span> attackSide;</span><br><span class="line">            <span class="keyword">if</span> (leftDevilNum &gt; leftPriestNum)</span><br><span class="line">                attackSide = <span class="number">-1</span>;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">                attackSide = <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span>(<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(Devils[i].GetSide() == attackSide)</span><br><span class="line">                    Devils[i].Attack();</span><br><span class="line">            &#125;</span><br><span class="line">            gaming = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">-1</span>; <span class="comment">//lose</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>; <span class="comment">//continue</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MoveRole</span>(<span class="params">RoleModel role</span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="keyword">if</span> (!gaming)</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="comment">//当其他角色还在移动时，不允许移动</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (Priests[i].IsMoving() || Devils[i].IsMoving())</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果还在前进，return</span></span><br><span class="line">        <span class="keyword">if</span> (Boat.IsMoving())</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (role.IsOnBoat())        <span class="comment">//上岸</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//这里，为了和原游戏一致，使牧师和魔鬼在两边的排列顺序一致</span></span><br><span class="line">            role = Boat.DeletePassenger(role);</span><br><span class="line">            Vector3 direction;</span><br><span class="line">            <span class="keyword">int</span> id = role.GetName()[role.GetName().Length - <span class="number">1</span>] - <span class="string">'0'</span>;</span><br><span class="line">            <span class="keyword">if</span> (role.IsGood())</span><br><span class="line">            &#123;</span><br><span class="line">                direction = PrisetsOriginPositions[id];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                direction = DevilsOriginPositions[id];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(role.GetSide() == <span class="number">-1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                direction.x = <span class="number">0</span> - direction.x;</span><br><span class="line">            &#125;</span><br><span class="line">            role.Move(direction);</span><br><span class="line">            role.GoLand();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>                        <span class="comment">//上船</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (Boat.IsFull() || Boat.GetSide() != role.GetSide())</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            role.Move(Boat.getEmptyPosition());</span><br><span class="line">            role.GoBoat(Boat);</span><br><span class="line">            Boat.AddPassenger(role);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">MoveBoat</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        <span class="comment">//当船为空，或者船已经在动时，不允许移动船</span></span><br><span class="line">        <span class="keyword">if</span> (!Boat.IsEmpty() &amp;&amp; !Boat.IsMoving())</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//当角色还在移动时，不允许移动船</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">3</span>; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span> (Priests[i].IsMoving() || Devils[i].IsMoving())</span><br><span class="line">                    <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            Boat.Move();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>完成上述代码后，游戏的逻辑也基本完成了。</p>
<h6 id="细节部分"><a href="#细节部分" class="headerlink" title="细节部分"></a>细节部分</h6><ul>
<li>船未靠岸，牧师与魔鬼上下船运动中，均不能接受用户事件：只需要在UserAction的函数中判断Move类中的state即可(具体代码见上面)，如果state表明正在移动，则直接返回，不进行任何操作。</li>
<li>同样的，当游戏胜利或者失败后，同样不能接受除了Restart以外的任何用户事件。</li>
</ul>
<h6 id="模型动作"><a href="#模型动作" class="headerlink" title="模型动作"></a>模型动作</h6><p>在下载模型时，发现了模型好像自带有动画(Animator组件)，于是就上网查了以下如何给人物附加动画。大致就是创建一个Animator Controller，通过给模型创建状态，并为不同状态绑定不同的动画效果，状态之间的转换需要一些特定的条件，在代码中触发这些条件实现动画切换。</p>
<p>上述可能解释的不是很清楚，具体可以参考这个<a href="https://blog.csdn.net/ChinarCSDN/article/details/81437311" target="_blank" rel="noopener">博客</a></p>
<h6 id="游戏主界面"><a href="#游戏主界面" class="headerlink" title="游戏主界面"></a>游戏主界面</h6><img src="/2019/09/16/3D-Game-Programming-Design-空间与运动/p&d.png">

<p><a href="https://www.bilibili.com/video/av68331555" target="_blank" rel="noopener">完整游戏视频</a></p>
<p><a href="https://github.com/DanielXuuuuu/Unity3D-Learning/tree/master/Priests_and_Devils" target="_blank" rel="noopener">项目地址</a></p>
<h6 id="游戏优化"><a href="#游戏优化" class="headerlink" title="游戏优化"></a>游戏优化</h6><ul>
<li>人物的移动做的还是比较粗糙，特别是河岸和船之间的路，我参考了往届同学的思路，使用了一个中间点用于转折，但应该还可以有更好的实现。</li>
<li>可以模仿原游戏，增加计时功能；也可以在起始时增加选项，根据玩家选择的难度增加牧师与恶魔的数量，以增加游戏难度与趣味。</li>
<li>在开始和结束游戏时，制作额外的场景用于和玩家交互</li>
</ul>
<p>下次的作业还是这个游戏，希望可以完成一些上述提到的想法，欢迎关注后续文章。</p>
<h6 id="感想"><a href="#感想" class="headerlink" title="感想"></a>感想</h6><p>这应该算是一个比较完整的游戏了，整体做下来以后，感觉按这样的思路设计游戏的话，还是十分复杂的。虽然现在对于Unity的使用还只是停留在移动、旋转对象的层面，但即使这样一个逻辑十分简单的游戏，仍有很多细节需要去判断，需要制定好每个对象的行为和位置，否则很容易出现Bug，就更不用说那些复杂的游戏了，简直不敢想象。我自身对于MVC模式掌握的也不够熟练，很多函数写的也比较繁琐。</p>
<p>但整个游戏的制作过程还是很愉快的，特别是在Asset Store下载了一些模型后，对于把游戏做精美的欲望更加强烈了。模型的使用、模型动画机制的运用让我对于接下来的学习3D游戏设计以及Unity的使用更加期待了。</p>

    </article>
    <!-- license  -->
    
        <div class="license-wrapper">
            <p>原文作者：<a href="http://yoursite.com">Daniel Xu</a>
            <p>原文链接：<a href="http://yoursite.com/2019/09/16/3D-Game-Programming-Design-空间与运动/">http://yoursite.com/2019/09/16/3D-Game-Programming-Design-空间与运动/</a>
            <p>发表日期：<a href="http://yoursite.com/2019/09/16/3D-Game-Programming-Design-空间与运动/">September 16th 2019, 4:48:24 pm</a>
            <p>更新日期：<a href="http://yoursite.com/2019/09/16/3D-Game-Programming-Design-空间与运动/">February 18th 2020, 10:32:15 pm</a>
            <p>版权声明：本文采用<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">知识共享署名-非商业性使用 4.0 国际许可协议</a>进行许可</p>
        </div>
    
    <!-- paginator  -->
    <ul class="post-paginator">
        <li class="next">
            
                <div class="nextSlogan">Next Post</div>
                <a href= "/2019/09/22/3D-Game-Programming-Design-游戏对象与图形基础/" title= "3D-Game-Programming-Design-游戏对象与图形基础">
                    <div class="nextTitle">3D-Game-Programming-Design-游戏对象与图形基础</div>
                </a>
            
        </li>
        <li class="previous">
            
                <div class="prevSlogan">Previous Post</div>
                <a href= "/2019/09/12/初次接触Go语言/" title= "初次接触Go语言">
                    <div class="prevTitle">初次接触Go语言</div>
                </a>
            
        </li>
    </ul>
    <!-- 评论插件 -->
    <!-- 来必力City版安装代码 -->

<!-- City版安装代码已完成 -->
    
    <div id="disqus_thread"></div>
    <script>
        /**
    *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
    *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
        
        var disqus_config = function () {
        this.page.url = "http://yoursite.com/2019/09/16/3D-Game-Programming-Design-空间与运动/";  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = "3D Game Programming & Design - 空间与运动"; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
        };
        
        (function () { // DON'T EDIT BELOW THIS LINE
            var d = document, s = d.createElement('script');
            s.src = 'https://danielxus-blog.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();

    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>

    
    <!-- partial('_partial/comment/changyan') -->
    <!--PC版-->


    
    

    <!-- 评论 -->
</main>
            <!-- profile -->
            
        </div>
        <footer class="footer footer-unloaded">
    <!-- social  -->
    
    <div class="social">
        
    
        
            
                <a href="mailto:979223119@qq.com" class="iconfont-archer email" title=email ></a>
            
        
    
        
            
                <a href="//github.com/DanielXuuuuu" class="iconfont-archer github" target="_blank" title=github></a>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
    
        
            
                <a href="//juejin.im/user/5db9293ce51d452a0a3afbab" class="iconfont-archer juejin" target="_blank" title=juejin></a>
            
        
    
        
    
        
    
        
    
        
    
        
    
        
    

    </div>
    
    <!-- powered by Hexo  -->
    <div class="copyright">
        <span id="hexo-power">Powered by <a href="https://hexo.io/" target="_blank">Hexo</a></span><span class="iconfont-archer power">&#xe635;</span><span id="theme-info">theme <a href="https://github.com/fi3ework/hexo-theme-archer" target="_blank">Archer</a></span>
    </div>
    <!-- 不蒜子  -->
    
    <div class="busuanzi-container">
    
     
    <span id="busuanzi_container_site_pv">PV: <span id="busuanzi_value_site_pv"></span> :)</span>
    
    </div>
    
</footer>
    </div>
    <!-- toc -->
    
    <div class="toc-wrapper" style=
    







top:50vh;

    >
        <div class="toc-catalog">
            <span class="iconfont-archer catalog-icon">&#xe613;</span><span>CATALOG</span>
        </div>
        <ol class="toc"><li class="toc-item toc-level-5"><a class="toc-link" href="#简答并用程序验证"><span class="toc-number">1.</span> <span class="toc-text">简答并用程序验证</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#编程实践"><span class="toc-number">2.</span> <span class="toc-text">编程实践</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#要求"><span class="toc-number">2.1.</span> <span class="toc-text">要求</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#游戏分析与前期准备"><span class="toc-number">2.2.</span> <span class="toc-text">游戏分析与前期准备</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#代码实例"><span class="toc-number">2.3.</span> <span class="toc-text">代码实例</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#细节部分"><span class="toc-number">2.4.</span> <span class="toc-text">细节部分</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#模型动作"><span class="toc-number">2.5.</span> <span class="toc-text">模型动作</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#游戏主界面"><span class="toc-number">2.6.</span> <span class="toc-text">游戏主界面</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#游戏优化"><span class="toc-number">2.7.</span> <span class="toc-text">游戏优化</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#感想"><span class="toc-number">2.8.</span> <span class="toc-text">感想</span></a></li></ol></li></ol>
    </div>
    
    <div class="back-top iconfont-archer">&#xe639;</div>
    <div class="sidebar sidebar-hide">
    <ul class="sidebar-tabs sidebar-tabs-active-0">
        <li class="sidebar-tab-archives"><span class="iconfont-archer">&#xe67d;</span><span class="tab-name">Archive</span></li>
        <li class="sidebar-tab-tags"><span class="iconfont-archer">&#xe61b;</span><span class="tab-name">Tag</span></li>
        <li class="sidebar-tab-categories"><span class="iconfont-archer">&#xe666;</span><span class="tab-name">Cate</span></li>
    </ul>
    <div class="sidebar-content sidebar-content-show-archive">
          <div class="sidebar-panel-archives">
    <!-- 在ejs中将archive按照时间排序 -->
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    
    <div class="total-and-search">
        <div class="total-archive">
        Total : 22
        </div>
        <!-- search  -->
        
    </div>
    
    <div class="post-archive">
    
    
    
    
    <div class="archive-year"> 2019 </div>
    <ul class="year-list">
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/29</span><a class="archive-post-title" href= "/2019/12/29/CSS布局学习-｜-两列等高布局/" >CSS布局学习｜两列等高布局</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/16</span><a class="archive-post-title" href= "/2019/12/16/3D-Game-Programming-Design-AR小游戏/" >3D-Game-Programming-Design | AR小游戏</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/14</span><a class="archive-post-title" href= "/2019/12/14/Sevice-Computing-初识Docker/" >Sevice-Computing | 初识Docker</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">12/01</span><a class="archive-post-title" href= "/2019/12/01/3D-Game-Programming-Design-游戏智能/" >3D Game Programming & Design - 游戏智能</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/26</span><a class="archive-post-title" href= "/2019/11/26/《Javascript高级程序设计》学习-闭包/" >《Javascript高级程序设计》学习 | 闭包</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/24</span><a class="archive-post-title" href= "/2019/11/24/CSS布局学习-圣杯、双飞翼布局/" >CSS布局学习 | 圣杯、双飞翼布局</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/22</span><a class="archive-post-title" href= "/2019/11/22/《Javascript高级程序设计》学习-对象、原型/" >《Javascript高级程序设计》学习 | 对象、原型</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/19</span><a class="archive-post-title" href= "/2019/11/19/《Javascript高级程序设计》学习-函数、变量、作用域/" >《Javascript高级程序设计》学习 | 函数、变量、作用域</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/18</span><a class="archive-post-title" href= "/2019/11/18/MD5算法的C语言实现/" >MD5算法的C语言实现</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">11/17</span><a class="archive-post-title" href= "/2019/11/17/3D-Game-Programming-Design-UI系统/" >3D-Game-Programming-Design-UI系统</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/29</span><a class="archive-post-title" href= "/2019/10/29/3D-Game-Programming-Design-粒子系统/" >3D-Game-Programming-Design-粒子系统</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/24</span><a class="archive-post-title" href= "/2019/10/24/3D-Game-Programming-Design-模型与动画/" >3D-Game-Programming-Design-模型与动画</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/17</span><a class="archive-post-title" href= "/2019/10/17/3D-Game-Programming-Design-物理系统与碰撞/" >3D-Game-Programming-Design - 物理系统与碰撞</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/15</span><a class="archive-post-title" href= "/2019/10/15/浅谈PoW（Proof-of-Work）共识机制/" >浅谈PoW（Proof of Work）共识机制</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">10/06</span><a class="archive-post-title" href= "/2019/10/06/3D-Game-Programming-Design-与游戏世界交互/" >3D-Game-Programming-Design-与游戏世界交互</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/22</span><a class="archive-post-title" href= "/2019/09/22/3D-Game-Programming-Design-游戏对象与图形基础/" >3D-Game-Programming-Design-游戏对象与图形基础</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/16</span><a class="archive-post-title" href= "/2019/09/16/3D-Game-Programming-Design-空间与运动/" >3D Game Programming & Design - 空间与运动</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/12</span><a class="archive-post-title" href= "/2019/09/12/初次接触Go语言/" >初次接触Go语言</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/10</span><a class="archive-post-title" href= "/2019/09/10/Sevice-Computing-在Linux中安装配置Go开发环境/" >Sevice Computing - 在Linux中安装配置Go开发环境</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/04</span><a class="archive-post-title" href= "/2019/09/04/3D-Game-Programming-Design-离散仿真引擎基础/" >3D Game Programming & Design - 离散仿真引擎基础</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/01</span><a class="archive-post-title" href= "/2019/09/01/Human Resource Machine - 一款杂糅了编程元素的另类解谜游戏/" >Human Resource Machine - 一款杂糅了编程元素的另类解谜游戏</a>
        </li>
    
    
        <li class="archive-post-item">
            <span class="archive-post-date">09/01</span><a class="archive-post-title" href= "/2019/09/01/Sevice-Computing-Windows环境下使用VirtualBox搭建云桌面/" >Sevice Computing - Windows环境下使用VirtualBox搭建云桌面</a>
        </li>
    
    </div>
  </div>
        <div class="sidebar-panel-tags">
    <div class="sidebar-tags-name">
    
        <span class="sidebar-tag-name" data-tags="课程作业"><span class="iconfont-archer">&#xe606;</span>课程作业</span>
    
        <span class="sidebar-tag-name" data-tags="Unity"><span class="iconfont-archer">&#xe606;</span>Unity</span>
    
        <span class="sidebar-tag-name" data-tags="CSS"><span class="iconfont-archer">&#xe606;</span>CSS</span>
    
        <span class="sidebar-tag-name" data-tags="前端"><span class="iconfont-archer">&#xe606;</span>前端</span>
    
        <span class="sidebar-tag-name" data-tags="编程游戏"><span class="iconfont-archer">&#xe606;</span>编程游戏</span>
    
        <span class="sidebar-tag-name" data-tags="解谜"><span class="iconfont-archer">&#xe606;</span>解谜</span>
    
        <span class="sidebar-tag-name" data-tags="MD5"><span class="iconfont-archer">&#xe606;</span>MD5</span>
    
        <span class="sidebar-tag-name" data-tags="c"><span class="iconfont-archer">&#xe606;</span>c</span>
    
        <span class="sidebar-tag-name" data-tags="云桌面"><span class="iconfont-archer">&#xe606;</span>云桌面</span>
    
        <span class="sidebar-tag-name" data-tags="服务计算"><span class="iconfont-archer">&#xe606;</span>服务计算</span>
    
        <span class="sidebar-tag-name" data-tags="CentOS"><span class="iconfont-archer">&#xe606;</span>CentOS</span>
    
        <span class="sidebar-tag-name" data-tags="ssh"><span class="iconfont-archer">&#xe606;</span>ssh</span>
    
        <span class="sidebar-tag-name" data-tags="Docker"><span class="iconfont-archer">&#xe606;</span>Docker</span>
    
        <span class="sidebar-tag-name" data-tags="Go语言"><span class="iconfont-archer">&#xe606;</span>Go语言</span>
    
        <span class="sidebar-tag-name" data-tags="Javascript"><span class="iconfont-archer">&#xe606;</span>Javascript</span>
    
        <span class="sidebar-tag-name" data-tags="PoW共识机制"><span class="iconfont-archer">&#xe606;</span>PoW共识机制</span>
    
        <span class="sidebar-tag-name" data-tags="区块链"><span class="iconfont-archer">&#xe606;</span>区块链</span>
    
    </div>
    <div class="iconfont-archer sidebar-tags-empty">&#xe678;</div>
    <div class="tag-load-fail" style="display: none; color: #ccc; font-size: 0.6rem;">
    缺失模块。<br/>
    1、请确保node版本大于6.2<br/>
    2、在博客根目录（注意不是archer根目录）执行以下命令：<br/>
    <span style="color: #f75357; font-size: 1rem; line-height: 2rem;">npm i hexo-generator-json-content --save</span><br/>
    3、在根目录_config.yml里添加配置：
    <pre style="color: #787878; font-size: 0.6rem;">
jsonContent:
  meta: false
  pages: false
  posts:
    title: true
    date: true
    path: true
    text: false
    raw: false
    content: false
    slug: false
    updated: false
    comments: false
    link: false
    permalink: false
    excerpt: false
    categories: true
    tags: true</pre>
    </div> 
    <div class="sidebar-tags-list"></div>
</div>
        <div class="sidebar-panel-categories">
    <div class="sidebar-categories-name">
    
        <span class="sidebar-category-name" data-categories="3D游戏编程"><span class="iconfont-archer">&#xe60a;</span>3D游戏编程</span>
    
        <span class="sidebar-category-name" data-categories="CSS学习笔记"><span class="iconfont-archer">&#xe60a;</span>CSS学习笔记</span>
    
        <span class="sidebar-category-name" data-categories="信息安全"><span class="iconfont-archer">&#xe60a;</span>信息安全</span>
    
        <span class="sidebar-category-name" data-categories="服务计算"><span class="iconfont-archer">&#xe60a;</span>服务计算</span>
    
        <span class="sidebar-category-name" data-categories="Javascript学习笔记"><span class="iconfont-archer">&#xe60a;</span>Javascript学习笔记</span>
    
        <span class="sidebar-category-name" data-categories="区块链"><span class="iconfont-archer">&#xe60a;</span>区块链</span>
    
    </div>
    <div class="iconfont-archer sidebar-categories-empty">&#xe678;</div>
    <div class="sidebar-categories-list"></div>
</div>
    </div>
</div> 
    <script>
    var siteMeta = {
        root: "/",
        author: "Daniel Xu"
    }
</script>
    <!-- CDN failover -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
    <script type="text/javascript">
        if (typeof window.$ === 'undefined')
        {
            console.warn('jquery load from jsdelivr failed, will load local script')
            document.write('<script src="/lib/jquery.min.js">\x3C/script>')
        }
    </script>
    <script src="/scripts/main.js"></script>
    <!-- algolia -->
    
    <!-- busuanzi  -->
    
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    
    <!-- CNZZ  -->
    
    </div>
    <!-- async load share.js -->
    
        <script src="/scripts/share.js" async></script>    
     
    </body>
</html>


